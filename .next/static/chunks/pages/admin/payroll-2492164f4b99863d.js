(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[922],{4506:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/payroll",function(){return t(9108)}])},9108:function(e,s,t){"use strict";t.r(s);var a=t(5893),l=t(7294),n=t(9008),i=t.n(n),r=t(5770),c=t(1163),d=t(889),m=t(8154),x=t(4410),o=t(1263),h=t(5615),g=t(7145),j=t(3431),u=t(2044),N=t(4931),y=t(8660),p=t(6458);s.default=()=>{let{user:e,isAuthenticated:s,isLoading:t}=(0,r.a)(),n=(0,c.useRouter)(),{addToast:f}=(0,d.p)(),[v,b]=(0,l.useState)([]),[w,_]=(0,l.useState)(!0),[k,D]=(0,l.useState)(!1),[P,S]=(0,l.useState)(()=>{let e=new Date;return"".concat(e.getFullYear(),"-").concat(String(e.getMonth()+1).padStart(2,"0"))}),[E,T]=(0,l.useState)(null),[G,Z]=(0,l.useState)(!1);(0,l.useEffect)(()=>{t||s?t||!s||["admin","manager"].includes((null==e?void 0:e.role)||"")||n.push("/dashboard"):n.push("/login")},[s,t,e,n]),(0,l.useEffect)(()=>{s&&["admin","manager"].includes((null==e?void 0:e.role)||"")&&C()},[s,e,P]);let C=async()=>{try{_(!0);let e=await p.vb.getDeductions(P);if(e.success)b(e.data||[]);else throw Error(e.message)}catch(e){f({type:"error",title:"Error",message:e.message||"Gagal memuat data payroll"})}finally{_(!1)}},F=async()=>{try{D(!0);let e=await p.vb.processDeductions(P);if(e.success)f({type:"success",title:"Berhasil",message:e.message}),C();else throw Error(e.message)}catch(e){f({type:"error",title:"Error",message:e.message||"Gagal memproses payroll"})}finally{D(!1)}},M=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e),I=e=>{let[s,t]=e.split("-");return"".concat(["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"][parseInt(t)-1]," ").concat(s)},A={totalEmployees:v.length,employeesWithDeductions:v.filter(e=>e.total_deduction>0).length,totalDeductions:v.reduce((e,s)=>e+s.total_deduction,0),totalNetSalary:v.reduce((e,s)=>e+s.net_salary,0)};return!t&&s&&["admin","manager"].includes((null==e?void 0:e.role)||"")?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(i(),{children:[(0,a.jsx)("title",{children:"Payroll & Pemotongan Gaji - AFMS"}),(0,a.jsx)("meta",{name:"description",content:"Sistem payroll dan pemotongan gaji otomatis"})]}),(0,a.jsxs)(m.Z,{children:[(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Payroll & Pemotongan Gaji"}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:"Sistem pemotongan gaji otomatis berdasarkan aturan absensi"})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(o.Z,{className:"h-5 w-5 text-gray-400"}),(0,a.jsx)("select",{value:P,onChange:e=>S(e.target.value),className:"border border-gray-300 rounded-md px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary-500",children:Array.from({length:12},(e,s)=>{let t=new Date;t.setMonth(t.getMonth()-s);let l="".concat(t.getFullYear(),"-").concat(String(t.getMonth()+1).padStart(2,"0"));return(0,a.jsx)("option",{value:l,children:I(l)},l)})})]}),(0,a.jsx)(x.z,{onClick:F,loading:k,leftIcon:(0,a.jsx)(h.Z,{className:"h-4 w-4"}),children:"Proses Payroll"})]})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"h-12 w-12 bg-primary-500 rounded-lg flex items-center justify-center",children:(0,a.jsx)(g.Z,{className:"h-6 w-6 text-white"})})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Karyawan"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:A.totalEmployees})]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"h-12 w-12 bg-warning-500 rounded-lg flex items-center justify-center",children:(0,a.jsx)(j.Z,{className:"h-6 w-6 text-white"})})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Dengan Potongan"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:A.employeesWithDeductions})]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"h-12 w-12 bg-danger-500 rounded-lg flex items-center justify-center",children:(0,a.jsx)(h.Z,{className:"h-6 w-6 text-white"})})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Potongan"}),(0,a.jsx)("p",{className:"text-lg font-bold text-gray-900",children:M(A.totalDeductions)})]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"h-12 w-12 bg-success-500 rounded-lg flex items-center justify-center",children:(0,a.jsx)(u.Z,{className:"h-6 w-6 text-white"})})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Gaji Bersih"}),(0,a.jsx)("p",{className:"text-lg font-bold text-gray-900",children:M(A.totalNetSalary)})]})]})})]}),(0,a.jsxs)("div",{className:"bg-white shadow-sm rounded-lg overflow-hidden",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,a.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["Daftar Karyawan - ",I(P)]})}),w?(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,a.jsx)("div",{className:"animate-pulse",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"h-12 w-12 bg-gray-200 rounded-lg"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),(0,a.jsx)("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]}),(0,a.jsx)("div",{className:"h-8 w-24 bg-gray-200 rounded"})]})},s))})}):(0,a.jsx)("div",{className:"divide-y divide-gray-200",children:v.map(e=>(0,a.jsxs)("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:(0,y.cn)("h-12 w-12 rounded-lg flex items-center justify-center",e.total_deduction>0?"bg-warning-100":"bg-success-100"),children:(0,a.jsx)(g.Z,{className:(0,y.cn)("h-6 w-6",e.total_deduction>0?"text-warning-600":"text-success-600")})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-lg font-medium text-gray-900",children:e.name}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 mt-1",children:[(0,a.jsx)("span",{className:"text-sm text-gray-500",children:e.jabatan}),(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:["Gaji Pokok: ",M(e.basic_salary)]})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Potongan"}),(0,a.jsx)("p",{className:(0,y.cn)("text-lg font-bold",e.total_deduction>0?"text-danger-600":"text-gray-900"),children:M(e.total_deduction)})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Gaji Bersih"}),(0,a.jsx)("p",{className:"text-lg font-bold text-success-600",children:M(e.net_salary)})]}),(0,a.jsx)(x.z,{variant:"outline",size:"sm",onClick:()=>{T(e),Z(!0)},leftIcon:(0,a.jsx)(N.Z,{className:"h-4 w-4"}),children:"Detail"})]})]}),(0,a.jsxs)("div",{className:"mt-4 grid grid-cols-2 md:grid-cols-5 gap-4",children:[(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Hadir"}),(0,a.jsxs)("p",{className:"text-lg font-semibold text-success-600",children:[e.attendance_summary.present_days,"/",e.attendance_summary.total_days]})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Terlambat"}),(0,a.jsxs)("p",{className:"text-lg font-semibold text-warning-600",children:[e.attendance_summary.late_count,"x"]})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Alpha"}),(0,a.jsxs)("p",{className:"text-lg font-semibold text-danger-600",children:[e.attendance_summary.absent_count,"x"]})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Pulang Cepat"}),(0,a.jsxs)("p",{className:"text-lg font-semibold text-warning-600",children:[e.attendance_summary.early_leave_count,"x"]})]}),(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"Total Potongan"}),(0,a.jsxs)("p",{className:"text-lg font-semibold text-danger-600",children:[e.deductions.length," item"]})]})]})]},e.karyawan_id))})]})]}),G&&E&&(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,a.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-11/12 md:w-3/4 lg:w-1/2 shadow-lg rounded-md bg-white",children:(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,a.jsxs)("h3",{className:"text-lg font-medium text-gray-900",children:["Detail Pemotongan Gaji - ",E.name]}),(0,a.jsx)("button",{onClick:()=>Z(!1),className:"text-gray-400 hover:text-gray-600",children:"✕"})]}),(0,a.jsx)("div",{className:"space-y-4",children:0===E.deductions.length?(0,a.jsx)("p",{className:"text-gray-500 text-center py-8",children:"Tidak ada pemotongan gaji untuk periode ini"}):E.deductions.map(e=>(0,a.jsx)("div",{className:"border border-gray-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"font-medium text-gray-900",children:e.rule_name}),(0,a.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:e.description}),e.total_minutes&&(0,a.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Total: ",e.total_minutes," menit"]})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsxs)("p",{className:"text-lg font-bold text-danger-600",children:["-",M(e.deduction_amount)]}),(0,a.jsxs)("p",{className:"text-xs text-gray-500",children:[e.violation_count,"x pelanggaran"]})]})]})},e.id))}),(0,a.jsxs)("div",{className:"mt-6 pt-4 border-t border-gray-200",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-lg font-medium text-gray-900",children:"Total Potongan:"}),(0,a.jsx)("span",{className:"text-xl font-bold text-danger-600",children:M(E.total_deduction)})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,a.jsx)("span",{className:"text-lg font-medium text-gray-900",children:"Gaji Bersih:"}),(0,a.jsx)("span",{className:"text-xl font-bold text-success-600",children:M(E.net_salary)})]})]})]})})})]})]}):(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"loading-spinner w-8 h-8"})})}}},function(e){e.O(0,[474,501,154,888,774,179],function(){return e(e.s=4506)}),_N_E=e.O()}]);