(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[777],{411:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/monitoring",function(){return t(2633)}])},2633:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return D}});var a=t(5893),n=t(7294),r=t(9008),i=t.n(r),l=t(5770),c=t(1163),d=t(6458),o=t(889),m=t(8154),x=t(4410),u=t(1429),h=t(3431),g=t(9711),p=t(6162),f=t(3950),j=t(68),v=t(8660),w=()=>{let[e,s]=(0,n.useState)([]),[t,r]=(0,n.useState)("connecting"),[i,l]=(0,n.useState)(""),c=(0,n.useRef)(null);(0,n.useEffect)(()=>(d(),()=>{c.current&&c.current.close()}),[]);let d=()=>{try{r("connecting");let e=localStorage.getItem("auth_token"),t=e?"/api/fingerprint/realtime?token=".concat(encodeURIComponent(e)):"/api/fingerprint/realtime",a=new EventSource(t);c.current=a,a.onopen=()=>{r("connected")},a.onmessage=e=>{try{let t=JSON.parse(e.data);switch(t.type){case"connected":break;case"ping":l(t.timestamp||new Date().toISOString());break;case"attendance_record":t.data&&(s(e=>[t.data,...e.slice(0,49)]),l(new Date().toISOString()));break;case"records_cleared":s([])}}catch(e){}},a.onerror=e=>{r("disconnected"),setTimeout(()=>{var e;(null===(e=c.current)||void 0===e?void 0:e.readyState)===EventSource.CLOSED&&d()},5e3)}}catch(e){r("disconnected")}},o=e=>{switch(e){case"hadir":return(0,a.jsx)(u.Z,{className:"h-5 w-5 text-success-500"});case"terlambat":return(0,a.jsx)(h.Z,{className:"h-5 w-5 text-warning-500"});case"pulang_cepat":return(0,a.jsx)(g.Z,{className:"h-5 w-5 text-danger-500"});default:return(0,a.jsx)(p.Z,{className:"h-5 w-5 text-gray-500"})}},m=e=>{switch(e){case"hadir":return"Hadir";case"terlambat":return"Terlambat";case"pulang_cepat":return"Pulang Cepat";default:return e}},x=e=>{switch(e){case"hadir":return"bg-success-100 text-success-800";case"terlambat":return"bg-warning-100 text-warning-800";case"pulang_cepat":return"bg-danger-100 text-danger-800";default:return"bg-gray-100 text-gray-800"}},w=e=>{switch(e){case"fingerprint":return"\uD83D\uDC46";case"face":return"\uD83D\uDC64";case"card":return"\uD83D\uDCB3";default:return"\uD83D\uDD0D"}},N=e=>new Date(e).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),y=e=>new Date(e).toLocaleDateString("id-ID",{day:"2-digit",month:"2-digit",year:"numeric"});return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Monitoring Kehadiran Real-time"}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsxs)("div",{className:(0,v.cn)("flex items-center space-x-2 px-3 py-1 rounded-full text-sm font-medium","connected"===t?"bg-success-100 text-success-800":"connecting"===t?"bg-warning-100 text-warning-800":"bg-danger-100 text-danger-800"),children:[(0,a.jsx)("div",{className:(0,v.cn)("w-2 h-2 rounded-full","connected"===t?"bg-success-500":"connecting"===t?"bg-warning-500":"bg-danger-500")}),(0,a.jsx)("span",{children:"connected"===t?"Terhubung":"connecting"===t?"Menghubungkan...":"Terputus"})]}),i&&(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:["Update terakhir: ",N(i)]})]})]})}),(0,a.jsx)("div",{className:"max-h-96 overflow-y-auto",children:0===e.length?(0,a.jsxs)("div",{className:"p-8 text-center",children:[(0,a.jsx)(p.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-500",children:"Belum ada data kehadiran real-time"}),(0,a.jsx)("p",{className:"text-sm text-gray-400 mt-1",children:"Data akan muncul secara otomatis ketika ada aktivitas fingerprint"})]}):(0,a.jsx)("div",{className:"divide-y divide-gray-200",children:e.map(e=>(0,a.jsx)("div",{className:"p-4 hover:bg-gray-50 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:o(e.status)}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(f.Z,{className:"h-4 w-4 text-gray-400"}),(0,a.jsxs)("span",{className:"font-medium text-gray-900",children:["Karyawan #",e.karyawan_id]}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:w(e.verify_method)})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 mt-1",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(j.Z,{className:"h-4 w-4 text-gray-400"}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:e.device_id})]}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:y(e.timestamp)})]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("span",{className:(0,v.cn)("px-2 py-1 rounded-full text-xs font-medium","masuk"===e.type?"bg-blue-100 text-blue-800":"bg-purple-100 text-purple-800"),children:"masuk"===e.type?"Masuk":"Keluar"}),(0,a.jsx)("span",{className:(0,v.cn)("px-2 py-1 rounded-full text-xs font-medium",x(e.status)),children:m(e.status)}),(0,a.jsx)("span",{className:"text-sm font-mono text-gray-900",children:N(e.timestamp)})]})]})},e.id))})})]})};let N=n.forwardRef(function(e,s){let{title:t,titleId:a,...r}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":a},r),t?n.createElement("title",{id:a},t):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.348 14.652a3.75 3.75 0 0 1 0-5.304m5.304 0a3.75 3.75 0 0 1 0 5.304m-7.425 2.121a6.75 6.75 0 0 1 0-9.546m9.546 0a6.75 6.75 0 0 1 0 9.546M5.106 18.894c-3.808-3.807-3.808-9.98 0-13.788m13.788 0c3.808 3.807 3.808 9.98 0 13.788M12 12h.008v.008H12V12Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"}))}),y=n.forwardRef(function(e,s){let{title:t,titleId:a,...r}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":a},r),t?n.createElement("title",{id:a},t):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m3 3 8.735 8.735m0 0a.374.374 0 1 1 .53.53m-.53-.53.53.53m0 0L21 21M14.652 9.348a3.75 3.75 0 0 1 0 5.304m2.121-7.425a6.75 6.75 0 0 1 0 9.546m2.121-11.667c3.808 3.807 3.808 9.98 0 13.788m-9.546-4.242a3.733 3.733 0 0 1-1.06-2.122m-1.061 4.243a6.75 6.75 0 0 1-1.625-6.929m-.496 9.05c-3.068-3.067-3.664-7.67-1.79-11.334M12 12h.008v.008H12V12Z"}))}),b=n.forwardRef(function(e,s){let{title:t,titleId:a,...r}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":a},r),t?n.createElement("title",{id:a},t):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99"}))}),k=n.forwardRef(function(e,s){let{title:t,titleId:a,...r}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":a},r),t?n.createElement("title",{id:a},t):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.288 15.038a5.25 5.25 0 0 1 7.424 0M5.106 11.856c3.807-3.808 9.98-3.808 13.788 0M1.924 8.674c5.565-5.565 14.587-5.565 20.152 0M12.53 18.22l-.53.53-.53-.53a.75.75 0 0 1 1.06 0Z"}))});var _=t(5892);let E=n.forwardRef(function(e,s){let{title:t,titleId:a,...r}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":a},r),t?n.createElement("title",{id:a},t):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 0 0 2.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 0 0-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75 2.25 2.25 0 0 0-.1-.664m-5.8 0A2.251 2.251 0 0 1 13.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25ZM6.75 12h.008v.008H6.75V12Zm0 3h.008v.008H6.75V15Zm0 3h.008v.008H6.75V18Z"}))});var D=()=>{let{user:e,isAuthenticated:s,isLoading:t}=(0,l.a)(),r=(0,c.useRouter)(),{addToast:u}=(0,o.p)(),[h,g]=(0,n.useState)([]),[p,f]=(0,n.useState)(!0),[D,S]=(0,n.useState)(null),[M,C]=(0,n.useState)(null);(0,n.useEffect)(()=>{t||s?!t&&s&&(null==e?void 0:e.role)!=="admin"&&r.push("/dashboard"):r.push("/login")},[s,t,e,r]),(0,n.useEffect)(()=>{if(s&&(null==e?void 0:e.role)==="admin"){Z();let e=setInterval(Z,3e4);return()=>clearInterval(e)}},[s,e]);let Z=async()=>{try{f(!0);let e=await d.CV.getDevices();e.success&&e.data?g(e.data):g([{id:1,device_id:"FP001",device_name:"Fingerprint Scanner - Kantor Pusat",ip_address:"192.168.1.100",port:4370,status:"online",last_sync:"2024-01-15 10:30:00",total_users:150,total_records:2500,created_at:"2024-01-01 00:00:00",updated_at:"2024-01-15 10:30:00"},{id:2,device_id:"FP002",device_name:"Fingerprint Scanner - Cabang Jakarta",ip_address:"192.168.1.101",port:4370,status:"offline",last_sync:"2024-01-14 16:45:00",total_users:75,total_records:1200,created_at:"2024-01-01 00:00:00",updated_at:"2024-01-14 16:45:00"},{id:3,device_id:"FP003",device_name:"Fingerprint Scanner - Cabang Surabaya",ip_address:"192.168.1.102",port:4370,status:"online",last_sync:"2024-01-15 09:15:00",total_users:90,total_records:1800,created_at:"2024-01-01 00:00:00",updated_at:"2024-01-15 09:15:00"}])}catch(e){u({type:"error",title:"Error",message:e.message||"Gagal memuat data monitoring"})}finally{f(!1)}},L=async e=>{try{S(e);let s=await d.CV.syncDevice(e);if(s.success)u({type:"success",title:"Berhasil",message:"Sinkronisasi berhasil"}),Z();else throw Error(s.message)}catch(e){u({type:"error",title:"Error",message:e.message||"Gagal melakukan sinkronisasi"})}finally{S(null)}},I=async e=>{try{C(e);let s=await d.CV.testConnection(e);if(s.success)u({type:"success",title:"Berhasil",message:"Koneksi berhasil"});else throw Error(s.message)}catch(e){u({type:"error",title:"Error",message:e.message||"Gagal menguji koneksi"})}finally{C(null)}},O=e=>"online"===e?(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-success-100 text-success-800",children:[(0,a.jsx)(N,{className:"h-3 w-3 mr-1"}),"Daring"]}):(0,a.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-danger-100 text-danger-800",children:[(0,a.jsx)(y,{className:"h-3 w-3 mr-1"}),"Luring"]}),B=e=>new Date(e).toLocaleString("id-ID");return t||!s||(null==e?void 0:e.role)!=="admin"?(0,a.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,a.jsx)("div",{className:"loading-spinner w-8 h-8"})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(i(),{children:[(0,a.jsx)("title",{children:"Monitoring Fingerprint - AFMS"}),(0,a.jsx)("meta",{name:"description",content:"Monitoring perangkat fingerprint"})]}),(0,a.jsx)(m.Z,{children:(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Monitoring Fingerprint"}),(0,a.jsx)("p",{className:"text-gray-600 mt-1",children:"Monitor status dan kelola perangkat fingerprint"})]}),(0,a.jsx)(x.z,{onClick:Z,loading:p,leftIcon:(0,a.jsx)(b,{className:"h-4 w-4"}),children:"Segarkan"})]})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"h-12 w-12 bg-primary-500 rounded-lg flex items-center justify-center",children:(0,a.jsx)(j.Z,{className:"h-6 w-6 text-white"})})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Perangkat"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:h.length})]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"h-12 w-12 bg-success-500 rounded-lg flex items-center justify-center",children:(0,a.jsx)(k,{className:"h-6 w-6 text-white"})})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Daring"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:h.filter(e=>"online"===e.status).length})]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow-sm p-6",children:(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"flex-shrink-0",children:(0,a.jsx)("div",{className:"h-12 w-12 bg-danger-500 rounded-lg flex items-center justify-center",children:(0,a.jsx)(y,{className:"h-6 w-6 text-white"})})}),(0,a.jsxs)("div",{className:"ml-4",children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Luring"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:h.filter(e=>"offline"===e.status).length})]})]})})]}),(0,a.jsx)(w,{}),(0,a.jsxs)("div",{className:"bg-white shadow-sm rounded-lg overflow-hidden",children:[(0,a.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,a.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Daftar Perangkat"})}),p?(0,a.jsx)("div",{className:"p-6",children:(0,a.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0].map((e,s)=>(0,a.jsx)("div",{className:"animate-pulse",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:"h-12 w-12 bg-gray-200 rounded-lg"}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4 mb-2"}),(0,a.jsx)("div",{className:"h-3 bg-gray-200 rounded w-1/2"})]}),(0,a.jsx)("div",{className:"h-8 w-20 bg-gray-200 rounded"})]})},s))})}):(0,a.jsx)("div",{className:"divide-y divide-gray-200",children:h.map(e=>(0,a.jsxs)("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)("div",{className:(0,v.cn)("h-12 w-12 rounded-lg flex items-center justify-center","online"===e.status?"bg-success-100":"bg-danger-100"),children:(0,a.jsx)(j.Z,{className:(0,v.cn)("h-6 w-6","online"===e.status?"text-success-600":"text-danger-600")})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h4",{className:"text-lg font-medium text-gray-900",children:e.device_name}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 mt-1",children:[(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:["ID: ",e.device_id]}),(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:["IP: ",e.ip_address,":",e.port]}),O(e.status)]})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(x.z,{variant:"outline",size:"sm",onClick:()=>I(e.device_id),loading:M===e.device_id,leftIcon:(0,a.jsx)(k,{className:"h-4 w-4"}),children:"Tes"}),(0,a.jsx)(x.z,{variant:"default",size:"sm",onClick:()=>L(e.device_id),loading:D===e.device_id,leftIcon:(0,a.jsx)(b,{className:"h-4 w-4"}),children:"Sinkronisasi"})]})]}),(0,a.jsxs)("div",{className:"mt-4 grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(_.Z,{className:"h-4 w-4 text-gray-400"}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[e.total_users," Pengguna"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(E,{className:"h-4 w-4 text-gray-400"}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:[e.total_records," Rekaman"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(b,{className:"h-4 w-4 text-gray-400"}),(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["Sinkronisasi terakhir: ",e.last_sync?B(e.last_sync):"Belum pernah"]})]})]})]},e.id))})]})]})})]})}},3950:function(e,s,t){"use strict";var a=t(7294);let n=a.forwardRef(function(e,s){let{title:t,titleId:n,...r}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":n},r),t?a.createElement("title",{id:n},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 6a3.75 3.75 0 1 1-7.5 0 3.75 3.75 0 0 1 7.5 0ZM4.501 20.118a7.5 7.5 0 0 1 14.998 0A17.933 17.933 0 0 1 12 21.75c-2.676 0-5.216-.584-7.499-1.632Z"}))});s.Z=n},9711:function(e,s,t){"use strict";var a=t(7294);let n=a.forwardRef(function(e,s){let{title:t,titleId:n,...r}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":n},r),t?a.createElement("title",{id:n},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))});s.Z=n}},function(e){e.O(0,[474,151,154,888,774,179],function(){return e(e.s=411)}),_N_E=e.O()}]);