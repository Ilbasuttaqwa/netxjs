(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[338],{479:function(e,a,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/bon",function(){return s(9047)}])},5811:function(e,a,s){"use strict";s.d(a,{I:function(){return r}});var t=s(5893),n=s(7294),l=s(8660);let r=(0,n.forwardRef)((e,a)=>{let{className:s,type:n,label:r,error:i,helperText:c,leftIcon:d,rightIcon:o,id:m,...x}=e,u=m||"input-".concat(Math.random().toString(36).substr(2,9));return(0,t.jsxs)("div",{className:"w-full",children:[r&&(0,t.jsx)("label",{htmlFor:u,className:"form-label",children:r}),(0,t.jsxs)("div",{className:"relative",children:[d&&(0,t.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,t.jsx)("span",{className:"text-gray-400 text-sm",children:d})}),(0,t.jsx)("input",{type:n,id:u,className:(0,l.cn)("form-input",d&&"pl-10",o&&"pr-10",i&&"border-danger-300 focus:border-danger-500 focus:ring-danger-500",s),ref:a,...x}),o&&(0,t.jsx)("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:(0,t.jsx)("span",{className:"text-gray-400 text-sm",children:o})})]}),i&&(0,t.jsx)("p",{className:"form-error",children:i}),c&&!i&&(0,t.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:c})]})});r.displayName="Input"},9047:function(e,a,s){"use strict";s.r(a);var t=s(5893),n=s(7294),l=s(9008),r=s.n(l),i=s(5770),c=s(1163),d=s(6458),o=s(889),m=s(8154),x=s(4410),u=s(5811),h=s(5615),p=s(3681),j=s(3069),g=s(3950),b=s(6162),y=s(7530),f=s(5086),N=s(1594),v=s(8660);a.default=()=>{let{user:e,isAuthenticated:a,isLoading:s}=(0,i.a)(),l=(0,c.useRouter)(),{addToast:w}=(0,o.p)(),[k,_]=(0,n.useState)([]),[S,C]=(0,n.useState)([]),[B,E]=(0,n.useState)(!0),[T,z]=(0,n.useState)(""),[P,D]=(0,n.useState)("all"),[M,Z]=(0,n.useState)(1),[I,A]=(0,n.useState)(1),[F,K]=(0,n.useState)(!1),[O,G]=(0,n.useState)(null),[J,L]=(0,n.useState)({karyawan_id:0,jumlah_bon:0,cicilan_per_bulan:0,keterangan:""}),[q,R]=(0,n.useState)({}),[U,W]=(0,n.useState)(null),[X,H]=(0,n.useState)([]),[V,Q]=(0,n.useState)([]);(0,n.useEffect)(()=>{if(!s&&!a){l.push("/login");return}if(!s&&(null==e?void 0:e.role)!=="admin"){l.push("/dashboard");return}a&&(null==e?void 0:e.role)==="admin"&&(Y(),$())},[a,s,e,l,M,T,P]);let Y=async()=>{try{E(!0);let a=await fetch("/api/bon?page=".concat(M,"&search=").concat(T,"&status=").concat(P)),s=await a.json();if(s.success){var e;_(s.data),A((null===(e=s.pagination)||void 0===e?void 0:e.last_page)||1)}else w({type:"error",title:"Error",message:s.message||"Gagal mengambil data bon"})}catch(e){w({type:"error",title:"Error",message:"Terjadi kesalahan saat mengambil data bon"})}finally{E(!1)}},$=async()=>{try{let e=await d.T5.getKaryawan({limit:1e3});e.success&&e.data&&C(e.data.data)}catch(e){}},ee=async(e,a)=>{try{let s="/api/bon/eligibility?karyawan_id=".concat(e).concat(a?"&amount=".concat(a):""),t=await fetch(s),n=await t.json();if(n.success)return W(n.data),n.data}catch(e){}return null},ea=async e=>{e.preventDefault(),R({}),H([]),Q([]);try{let e={karyawan_id:J.karyawan_id,jumlah_bon:J.jumlah_bon,cicilan_per_bulan:J.cicilan_per_bulan,keterangan:J.keterangan},a=await fetch("/api/bon",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),s=await a.json();s.success?(w({type:"success",title:"Berhasil",message:"Bon berhasil diajukan"}),K(!1),er(),Y()):(s.errors&&R(s.errors),s.validationErrors&&H(s.validationErrors),s.validationWarnings&&Q(s.validationWarnings),w({type:"error",title:"Error",message:s.message||"Gagal mengajukan bon"}))}catch(e){w({type:"error",title:"Error",message:"Terjadi kesalahan saat mengajukan bon"})}},es=async e=>{L({...J,karyawan_id:parseInt(e)||0}),e?await ee(e):W(null)},et=async e=>{L({...J,jumlah_bon:parseFloat(e)||0}),J.karyawan_id&&e&&await ee(J.karyawan_id.toString(),e)},en=async e=>{try{let a=await fetch("/api/bon/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"approve"})}),s=await a.json();s.success?(w({type:"success",title:"Berhasil",message:"Bon berhasil disetujui"}),Y()):w({type:"error",title:"Error",message:s.message||"Gagal menyetujui bon"})}catch(e){w({type:"error",title:"Error",message:"Terjadi kesalahan saat menyetujui bon"})}},el=async e=>{try{let a=await fetch("/api/bon/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"reject"})}),s=await a.json();s.success?(w({type:"success",title:"Berhasil",message:"Bon berhasil ditolak"}),Y()):w({type:"error",title:"Error",message:s.message||"Gagal menolak bon"})}catch(e){w({type:"error",title:"Error",message:"Terjadi kesalahan saat menolak bon"})}},er=()=>{L({karyawan_id:0,jumlah_bon:0,cicilan_per_bulan:0,keterangan:""}),R({}),G(null),W(null),H([]),Q([])},ei=()=>{K(!1),er()},ec=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e),ed=e=>{let a={pending:{bg:"bg-yellow-100",text:"text-yellow-800",label:"Pending"},approved:{bg:"bg-green-100",text:"text-green-800",label:"Disetujui"},rejected:{bg:"bg-red-100",text:"text-red-800",label:"Ditolak"},completed:{bg:"bg-blue-100",text:"text-blue-800",label:"Selesai"},cancelled:{bg:"bg-gray-100",text:"text-gray-800",label:"Dibatalkan"}},s=a[e]||a.pending;return(0,t.jsx)("span",{className:(0,v.cn)("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",s.bg,s.text),children:s.label})};return s?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):(0,t.jsxs)(m.Z,{children:[(0,t.jsx)(r(),{children:(0,t.jsx)("title",{children:"Manajemen Bon - AFMS"})}),(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[(0,t.jsx)(h.Z,{className:"h-8 w-8 text-blue-600"}),"Manajemen Bon"]}),(0,t.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Kelola pengajuan dan persetujuan bon karyawan"})]}),(0,t.jsxs)(x.z,{onClick:()=>{er(),K(!0)},className:"mt-4 sm:mt-0",children:[(0,t.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),"Ajukan Bon Baru"]})]}),(0,t.jsx)("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(j.Z,{className:"h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,t.jsx)(u.I,{type:"text",placeholder:"Cari nama karyawan...",value:T,onChange:e=>z(e.target.value),className:"pl-10"})]})}),(0,t.jsx)("div",{className:"sm:w-48",children:(0,t.jsxs)("select",{value:P,onChange:e=>D(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,t.jsx)("option",{value:"all",children:"Semua Status"}),(0,t.jsx)("option",{value:"pending",children:"Pending"}),(0,t.jsx)("option",{value:"approved",children:"Disetujui"}),(0,t.jsx)("option",{value:"rejected",children:"Ditolak"}),(0,t.jsx)("option",{value:"completed",children:"Selesai"})]})})]})}),(0,t.jsxs)("div",{className:"bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden",children:[(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,t.jsx)("thead",{className:"bg-gray-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(g.Z,{className:"h-4 w-4"}),"Karyawan"]})}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(h.Z,{className:"h-4 w-4"}),"Jumlah Bon"]})}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(h.Z,{className:"h-4 w-4"}),"Sisa Bon"]})}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(b.Z,{className:"h-4 w-4"}),"Cicilan/Bulan"]})}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(y.Z,{className:"h-4 w-4"}),"Tanggal Pengajuan"]})}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,t.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Aksi"})]})}),(0,t.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:B?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:7,className:"px-6 py-4 text-center",children:(0,t.jsx)("div",{className:"flex justify-center",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})})})}):0===k.length?(0,t.jsx)("tr",{children:(0,t.jsx)("td",{colSpan:7,className:"px-6 py-4 text-center text-gray-500",children:"Tidak ada data bon"})}):k.map(e=>{var a,s;return(0,t.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,t.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-900",children:(null===(a=e.karyawan)||void 0===a?void 0:a.nama)||"N/A"}),(0,t.jsx)("div",{className:"text-sm text-gray-500",children:(null===(s=e.karyawan)||void 0===s?void 0:s.email)||"N/A"})]}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:ec(e.jumlah_bon)}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:ec(e.sisa_bon)}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:ec(e.cicilan_per_bulan)}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(e.tanggal_pengajuan).toLocaleDateString("id-ID")}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:ed(e.status)}),(0,t.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,t.jsx)("div",{className:"flex items-center gap-2",children:"pending"===e.status&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(x.z,{size:"sm",variant:"success",onClick:()=>en(e.id),children:(0,t.jsx)(f.Z,{className:"h-4 w-4"})}),(0,t.jsx)(x.z,{size:"sm",variant:"destructive",onClick:()=>el(e.id),children:(0,t.jsx)(N.Z,{className:"h-4 w-4"})})]})})})]},e.id)})})]})}),I>1&&(0,t.jsxs)("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:[(0,t.jsxs)("div",{className:"flex-1 flex justify-between sm:hidden",children:[(0,t.jsx)(x.z,{variant:"outline",onClick:()=>Z(Math.max(1,M-1)),disabled:1===M,children:"Previous"}),(0,t.jsx)(x.z,{variant:"outline",onClick:()=>Z(Math.min(I,M+1)),disabled:M===I,children:"Next"})]}),(0,t.jsxs)("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[(0,t.jsx)("div",{children:(0,t.jsxs)("p",{className:"text-sm text-gray-700",children:["Halaman ",(0,t.jsx)("span",{className:"font-medium",children:M})," dari"," ",(0,t.jsx)("span",{className:"font-medium",children:I})]})}),(0,t.jsx)("div",{children:(0,t.jsxs)("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[(0,t.jsx)(x.z,{variant:"outline",onClick:()=>Z(Math.max(1,M-1)),disabled:1===M,className:"rounded-r-none",children:"Previous"}),(0,t.jsx)(x.z,{variant:"outline",onClick:()=>Z(Math.min(I,M+1)),disabled:M===I,className:"rounded-l-none",children:"Next"})]})})]})]})]})]}),F&&(0,t.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,t.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,t.jsxs)("div",{className:"mt-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,t.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Ajukan Bon Baru"}),(0,t.jsx)("button",{onClick:ei,className:"text-gray-400 hover:text-gray-600",children:(0,t.jsx)(N.Z,{className:"h-6 w-6"})})]}),(0,t.jsxs)("form",{onSubmit:ea,className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Karyawan *"}),(0,t.jsxs)("select",{value:J.karyawan_id,onChange:e=>es(e.target.value),className:(0,v.cn)("w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",q.karyawan_id?"border-red-500":"border-gray-300"),required:!0,children:[(0,t.jsx)("option",{value:"",children:"Pilih Karyawan"}),S.map(e=>{var a;return(0,t.jsxs)("option",{value:e.id,children:[e.nama," - ",null===(a=e.jabatan)||void 0===a?void 0:a.nama_jabatan]},e.id)})]}),q.karyawan_id&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:q.karyawan_id})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Jumlah Bon *"}),(0,t.jsx)(u.I,{type:"number",value:J.jumlah_bon,onChange:e=>et(e.target.value),className:q.jumlah_bon?"border-red-500":"",placeholder:"Masukkan jumlah bon",required:!0}),q.jumlah_bon&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:q.jumlah_bon})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cicilan per Bulan *"}),(0,t.jsx)(u.I,{type:"number",value:J.cicilan_per_bulan,onChange:e=>L({...J,cicilan_per_bulan:parseFloat(e.target.value)||0}),className:q.cicilan_per_bulan?"border-red-500":"",placeholder:"Masukkan cicilan per bulan",required:!0}),q.cicilan_per_bulan&&(0,t.jsx)("p",{className:"mt-1 text-sm text-red-600",children:q.cicilan_per_bulan})]}),U&&(0,t.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"Informasi Kelayakan"}),(0,t.jsxs)("div",{className:"text-sm text-blue-800 space-y-1",children:[(0,t.jsxs)("p",{children:["Gaji Pokok: ",ec(U.gaji_pokok)]}),(0,t.jsxs)("p",{children:["Maksimal Bon: ",ec(U.max_bon_amount)]}),(0,t.jsxs)("p",{children:["Bon Aktif: ",ec(U.current_bon_amount)]}),(0,t.jsxs)("p",{children:["Sisa Limit: ",ec(U.remaining_limit)]}),(0,t.jsxs)("p",{className:"font-medium ".concat(U.is_eligible?"text-green-600":"text-red-600"),children:["Status: ",U.is_eligible?"Layak":"Tidak Layak"]})]})]}),X.length>0&&(0,t.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-red-900 mb-2",children:"Error Validasi"}),(0,t.jsx)("ul",{className:"text-sm text-red-800 space-y-1",children:X.map((e,a)=>(0,t.jsxs)("li",{children:["• ",e]},a))})]}),V.length>0&&(0,t.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:[(0,t.jsx)("h4",{className:"text-sm font-medium text-yellow-900 mb-2",children:"Peringatan"}),(0,t.jsx)("ul",{className:"text-sm text-yellow-800 space-y-1",children:V.map((e,a)=>(0,t.jsxs)("li",{children:["• ",e]},a))})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Keterangan"}),(0,t.jsx)("textarea",{value:J.keterangan,onChange:e=>L({...J,keterangan:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,placeholder:"Masukkan keterangan (opsional)"})]}),(0,t.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,t.jsx)(x.z,{type:"button",variant:"outline",onClick:ei,children:"Batal"}),(0,t.jsx)(x.z,{type:"submit",children:"Ajukan Bon"})]})]})]})})})]})}}},function(e){e.O(0,[474,429,154,888,774,179],function(){return e(e.s=479)}),_N_E=e.O()}]);