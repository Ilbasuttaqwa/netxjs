(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[338],{479:function(e,a,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/bon",function(){return t(7750)}])},1774:function(e,a,t){"use strict";t.d(a,{I:function(){return l}});var s=t(5893),n=t(7294),r=t(8660);let l=(0,n.forwardRef)((e,a)=>{let{className:t,type:n,label:l,error:i,helperText:c,leftIcon:d,rightIcon:o,id:m,...x}=e,u=m||"input-".concat(Math.random().toString(36).substr(2,9));return(0,s.jsxs)("div",{className:"w-full",children:[l&&(0,s.jsx)("label",{htmlFor:u,className:"form-label",children:l}),(0,s.jsxs)("div",{className:"relative",children:[d&&(0,s.jsx)("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:(0,s.jsx)("span",{className:"text-gray-400 text-sm",children:d})}),(0,s.jsx)("input",{type:n,id:u,className:(0,r.cn)("form-input-modern",d&&"pl-12",o&&"pr-12",i&&"border-red-400 focus:border-red-500 focus:ring-red-500 shadow-glow-rose","focus:shadow-glow transition-all duration-300",t),ref:a,...x}),o&&(0,s.jsx)("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:(0,s.jsx)("span",{className:"text-gray-400 text-sm",children:o})})]}),i&&(0,s.jsx)("p",{className:"form-error",children:i}),c&&!i&&(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:c})]})});l.displayName="Input"},7750:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return N}});var s=t(5893),n=t(7294),r=t(9008),l=t.n(r),i=t(5770),c=t(1163),d=t(6458),o=t(4607),m=t(3903),x=t(7245),u=t(1774),h=t(5615),p=t(3681),j=t(3069),g=t(3950),b=t(6162),y=t(7530);let f=n.forwardRef(function(e,a){let{title:t,titleId:s,...r}=e;return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":s},r),t?n.createElement("title",{id:s},t):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m4.5 12.75 6 6 9-13.5"}))});var w=t(1594),v=t(8660),N=()=>{let{user:e,isAuthenticated:a,isLoading:t}=(0,i.a)(),r=(0,c.useRouter)(),{addToast:N}=(0,o.p)(),[k,_]=(0,n.useState)([]),[S,C]=(0,n.useState)([]),[E,B]=(0,n.useState)(!0),[T,Z]=(0,n.useState)(""),[z,M]=(0,n.useState)("all"),[P,D]=(0,n.useState)(1),[I,L]=(0,n.useState)(1),[A,O]=(0,n.useState)(!1),[F,K]=(0,n.useState)(null),[R,G]=(0,n.useState)({karyawan_id:0,jumlah_bon:0,cicilan_per_bulan:0,keterangan:""}),[J,W]=(0,n.useState)({}),[q,U]=(0,n.useState)(null),[X,H]=(0,n.useState)([]),[V,Q]=(0,n.useState)([]);(0,n.useEffect)(()=>{if(!t&&!a){r.push("/login");return}if(!t&&(null==e?void 0:e.role)!=="admin"){r.push("/dasbor");return}a&&(null==e?void 0:e.role)==="admin"&&(Y(),$())},[a,t,e,r,P,T,z]);let Y=async()=>{try{B(!0);let a=await fetch("/api/bon?page=".concat(P,"&search=").concat(T,"&status=").concat(z)),t=await a.json();if(t.success){var e;_(t.data),L((null===(e=t.pagination)||void 0===e?void 0:e.last_page)||1)}else N({type:"error",title:"Error",message:t.message||"Gagal mengambil data bon"})}catch(e){N({type:"error",title:"Error",message:"Terjadi kesalahan saat mengambil data bon"})}finally{B(!1)}},$=async()=>{try{let e=await d.T5.getKaryawan({limit:1e3});e.success&&e.data&&C(e.data.data)}catch(e){}},ee=async(e,a)=>{try{let t="/api/bon/eligibility?karyawan_id=".concat(e).concat(a?"&amount=".concat(a):""),s=await fetch(t),n=await s.json();if(n.success)return U(n.data),n.data}catch(e){}return null},ea=async e=>{e.preventDefault(),W({}),H([]),Q([]);try{let e={karyawan_id:R.karyawan_id,jumlah_bon:R.jumlah_bon,cicilan_per_bulan:R.cicilan_per_bulan,keterangan:R.keterangan},a=await fetch("/api/bon",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),t=await a.json();t.success?(N({type:"success",title:"Berhasil",message:"Bon berhasil diajukan"}),O(!1),el(),Y()):(t.errors&&W(t.errors),t.validationErrors&&H(t.validationErrors),t.validationWarnings&&Q(t.validationWarnings),N({type:"error",title:"Error",message:t.message||"Gagal mengajukan bon"}))}catch(e){N({type:"error",title:"Error",message:"Terjadi kesalahan saat mengajukan bon"})}},et=async e=>{G({...R,karyawan_id:parseInt(e)||0}),e?await ee(e):U(null)},es=async e=>{G({...R,jumlah_bon:parseFloat(e)||0}),R.karyawan_id&&e&&await ee(R.karyawan_id.toString(),e)},en=async e=>{try{let a=await fetch("/api/bon/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"approve"})}),t=await a.json();t.success?(N({type:"success",title:"Berhasil",message:"Bon berhasil disetujui"}),Y()):N({type:"error",title:"Error",message:t.message||"Gagal menyetujui bon"})}catch(e){N({type:"error",title:"Error",message:"Terjadi kesalahan saat menyetujui bon"})}},er=async e=>{try{let a=await fetch("/api/bon/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"reject"})}),t=await a.json();t.success?(N({type:"success",title:"Berhasil",message:"Bon berhasil ditolak"}),Y()):N({type:"error",title:"Error",message:t.message||"Gagal menolak bon"})}catch(e){N({type:"error",title:"Error",message:"Terjadi kesalahan saat menolak bon"})}},el=()=>{G({karyawan_id:0,jumlah_bon:0,cicilan_per_bulan:0,keterangan:""}),W({}),K(null),U(null),H([]),Q([])},ei=()=>{O(!1),el()},ec=e=>new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0}).format(e),ed=e=>{let a={pending:{bg:"bg-yellow-100",text:"text-yellow-800",label:"Pending"},approved:{bg:"bg-green-100",text:"text-green-800",label:"Disetujui"},rejected:{bg:"bg-red-100",text:"text-red-800",label:"Ditolak"},completed:{bg:"bg-blue-100",text:"text-blue-800",label:"Selesai"},cancelled:{bg:"bg-gray-100",text:"text-gray-800",label:"Dibatalkan"}},t=a[e]||a.pending;return(0,s.jsx)("span",{className:(0,v.cn)("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",t.bg,t.text),children:t.label})};return t?(0,s.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})}):(0,s.jsxs)(m.Z,{children:[(0,s.jsx)(l(),{children:(0,s.jsx)("title",{children:"Manajemen Bon - AFMS"})}),(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h1",{className:"text-2xl font-bold text-gray-900 flex items-center gap-2",children:[(0,s.jsx)(h.Z,{className:"h-8 w-8 text-blue-600"}),"Manajemen Bon"]}),(0,s.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"Kelola pengajuan dan persetujuan bon karyawan"})]}),(0,s.jsxs)(x.z,{onClick:()=>{el(),O(!0)},className:"mt-4 sm:mt-0",children:[(0,s.jsx)(p.Z,{className:"h-4 w-4 mr-2"}),"Ajukan Bon Baru"]})]}),(0,s.jsx)("div",{className:"bg-white p-4 rounded-lg shadow-sm border border-gray-200",children:(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(j.Z,{className:"h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),(0,s.jsx)(u.I,{type:"text",placeholder:"Cari nama karyawan...",value:T,onChange:e=>Z(e.target.value),className:"pl-10"})]})}),(0,s.jsx)("div",{className:"sm:w-48",children:(0,s.jsxs)("select",{value:z,onChange:e=>M(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,s.jsx)("option",{value:"all",children:"Semua Status"}),(0,s.jsx)("option",{value:"pending",children:"Pending"}),(0,s.jsx)("option",{value:"approved",children:"Disetujui"}),(0,s.jsx)("option",{value:"rejected",children:"Ditolak"}),(0,s.jsx)("option",{value:"completed",children:"Selesai"})]})})]})}),(0,s.jsxs)("div",{className:"bg-white shadow-sm rounded-lg border border-gray-200 overflow-hidden",children:[(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(g.Z,{className:"h-4 w-4"}),"Karyawan"]})}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(h.Z,{className:"h-4 w-4"}),"Jumlah Bon"]})}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(h.Z,{className:"h-4 w-4"}),"Sisa Bon"]})}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(b.Z,{className:"h-4 w-4"}),"Cicilan/Bulan"]})}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(y.Z,{className:"h-4 w-4"}),"Tanggal Pengajuan"]})}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,s.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Aksi"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:E?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:7,className:"px-6 py-4 text-center",children:(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-blue-600"})})})}):0===k.length?(0,s.jsx)("tr",{children:(0,s.jsx)("td",{colSpan:7,className:"px-6 py-4 text-center text-gray-500",children:"Tidak ada data bon"})}):k.map(e=>{var a,t;return(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap",children:[(0,s.jsx)("div",{className:"text-sm font-medium text-gray-900",children:(null===(a=e.karyawan)||void 0===a?void 0:a.nama)||"N/A"}),(0,s.jsx)("div",{className:"text-sm text-gray-500",children:(null===(t=e.karyawan)||void 0===t?void 0:t.telepon)||"N/A"})]}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:ec(e.jumlah_bon)}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:ec(e.sisa_bon)}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:ec(e.cicilan_per_bulan)}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:new Date(e.tanggal_pengajuan).toLocaleDateString("id-ID")}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap",children:ed(e.status)}),(0,s.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:(0,s.jsx)("div",{className:"flex items-center gap-2",children:"pending"===e.status&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(x.z,{size:"sm",variant:"success",onClick:()=>en(e.id),children:(0,s.jsx)(f,{className:"h-4 w-4"})}),(0,s.jsx)(x.z,{size:"sm",variant:"destructive",onClick:()=>er(e.id),children:(0,s.jsx)(w.Z,{className:"h-4 w-4"})})]})})})]},e.id)})})]})}),I>1&&(0,s.jsxs)("div",{className:"bg-white px-4 py-3 flex items-center justify-between border-t border-gray-200 sm:px-6",children:[(0,s.jsxs)("div",{className:"flex-1 flex justify-between sm:hidden",children:[(0,s.jsx)(x.z,{variant:"outline",onClick:()=>D(Math.max(1,P-1)),disabled:1===P,children:"Previous"}),(0,s.jsx)(x.z,{variant:"outline",onClick:()=>D(Math.min(I,P+1)),disabled:P===I,children:"Next"})]}),(0,s.jsxs)("div",{className:"hidden sm:flex-1 sm:flex sm:items-center sm:justify-between",children:[(0,s.jsx)("div",{children:(0,s.jsxs)("p",{className:"text-sm text-gray-700",children:["Halaman ",(0,s.jsx)("span",{className:"font-medium",children:P})," dari"," ",(0,s.jsx)("span",{className:"font-medium",children:I})]})}),(0,s.jsx)("div",{children:(0,s.jsxs)("nav",{className:"relative z-0 inline-flex rounded-md shadow-sm -space-x-px",children:[(0,s.jsx)(x.z,{variant:"outline",onClick:()=>D(Math.max(1,P-1)),disabled:1===P,className:"rounded-r-none",children:"Previous"}),(0,s.jsx)(x.z,{variant:"outline",onClick:()=>D(Math.min(I,P+1)),disabled:P===I,className:"rounded-l-none",children:"Next"})]})})]})]})]})]}),A&&(0,s.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,s.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:(0,s.jsxs)("div",{className:"mt-3",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Ajukan Bon Baru"}),(0,s.jsx)("button",{onClick:ei,className:"text-gray-400 hover:text-gray-600",children:(0,s.jsx)(w.Z,{className:"h-6 w-6"})})]}),(0,s.jsxs)("form",{onSubmit:ea,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Karyawan *"}),(0,s.jsxs)("select",{value:R.karyawan_id,onChange:e=>et(e.target.value),className:(0,v.cn)("w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",J.karyawan_id?"border-red-500":"border-gray-300"),required:!0,children:[(0,s.jsx)("option",{value:"",children:"Pilih Karyawan"}),S.map(e=>{var a;return(0,s.jsxs)("option",{value:e.id,children:[e.nama," - ",null===(a=e.jabatan)||void 0===a?void 0:a.nama_jabatan]},e.id)})]}),J.karyawan_id&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:J.karyawan_id})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Jumlah Bon *"}),(0,s.jsx)(u.I,{type:"number",value:R.jumlah_bon,onChange:e=>es(e.target.value),className:J.jumlah_bon?"border-red-500":"",placeholder:"Masukkan jumlah bon",required:!0}),J.jumlah_bon&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:J.jumlah_bon})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cicilan per Bulan *"}),(0,s.jsx)(u.I,{type:"number",value:R.cicilan_per_bulan,onChange:e=>G({...R,cicilan_per_bulan:parseFloat(e.target.value)||0}),className:J.cicilan_per_bulan?"border-red-500":"",placeholder:"Masukkan cicilan per bulan",required:!0}),J.cicilan_per_bulan&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:J.cicilan_per_bulan})]}),q&&(0,s.jsxs)("div",{className:"bg-blue-50 border border-blue-200 rounded-md p-4",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-blue-900 mb-2",children:"Informasi Kelayakan"}),(0,s.jsxs)("div",{className:"text-sm text-blue-800 space-y-1",children:[(0,s.jsxs)("p",{children:["Gaji Pokok: ",ec(q.gaji_pokok)]}),(0,s.jsxs)("p",{children:["Maksimal Bon: ",ec(q.max_bon_amount)]}),(0,s.jsxs)("p",{children:["Bon Aktif: ",ec(q.current_bon_amount)]}),(0,s.jsxs)("p",{children:["Sisa Limit: ",ec(q.remaining_limit)]}),(0,s.jsxs)("p",{className:"font-medium ".concat(q.is_eligible?"text-green-600":"text-red-600"),children:["Status: ",q.is_eligible?"Layak":"Tidak Layak"]})]})]}),X.length>0&&(0,s.jsxs)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-red-900 mb-2",children:"Error Validasi"}),(0,s.jsx)("ul",{className:"text-sm text-red-800 space-y-1",children:X.map((e,a)=>(0,s.jsxs)("li",{children:["• ",e]},a))})]}),V.length>0&&(0,s.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4",children:[(0,s.jsx)("h4",{className:"text-sm font-medium text-yellow-900 mb-2",children:"Peringatan"}),(0,s.jsx)("ul",{className:"text-sm text-yellow-800 space-y-1",children:V.map((e,a)=>(0,s.jsxs)("li",{children:["• ",e]},a))})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Keterangan"}),(0,s.jsx)("textarea",{value:R.keterangan,onChange:e=>G({...R,keterangan:e.target.value}),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,placeholder:"Masukkan keterangan (opsional)"})]}),(0,s.jsxs)("div",{className:"flex justify-end space-x-3 pt-4",children:[(0,s.jsx)(x.z,{type:"button",variant:"outline",onClick:ei,children:"Batal"}),(0,s.jsx)(x.z,{type:"submit",children:"Ajukan Bon"})]})]})]})})})]})}},3069:function(e,a,t){"use strict";var s=t(7294);let n=s.forwardRef(function(e,a){let{title:t,titleId:n,...r}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":n},r),t?s.createElement("title",{id:n},t):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"}))});a.Z=n},3681:function(e,a,t){"use strict";var s=t(7294);let n=s.forwardRef(function(e,a){let{title:t,titleId:n,...r}=e;return s.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:a,"aria-labelledby":n},r),t?s.createElement("title",{id:n},t):null,s.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 4.5v15m7.5-7.5h-15"}))});a.Z=n}},function(e){e.O(0,[474,795,903,888,774,179],function(){return e(e.s=479)}),_N_E=e.O()}]);