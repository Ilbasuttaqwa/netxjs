(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[384],{7144:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin/device-monitoring",function(){return t(953)}])},953:function(e,s,t){"use strict";t.r(s);var a=t(5893),r=t(7294),l=t(1163),n=t(5770),i=t(4607),c=t(1429),d=t(9711),o=t(3431),m=t(1771),x=t(7355),h=t(3781),u=t(6162),g=t(3994);s.default=()=>{let e=(0,l.useRouter)(),{user:s,isLoading:t}=(0,n.a)(),{addToast:f}=(0,i.p)(),[j,v]=(0,r.useState)([]),[p,y]=(0,r.useState)(!0),[w,N]=(0,r.useState)(null),[b,_]=(0,r.useState)(!1),[k,E]=(0,r.useState)(!0),[Z,L]=(0,r.useState)(30),[C,M]=(0,r.useState)(""),[S,O]=(0,r.useState)("");(0,r.useEffect)(()=>{if(!t&&(!s||"admin"!==s.role)){e.push("/login");return}s&&R()},[s,t]),(0,r.useEffect)(()=>{let e;return k&&Z>0&&(e=setInterval(()=>{R()},1e3*Z)),()=>{e&&clearInterval(e)}},[k,Z]);let R=async()=>{try{let e=await fetch("/api/devices/sync?hours=24"),s=await e.json();s.success?v(s.data):f({type:"error",title:"Error",message:s.message||"Failed to fetch device statuses"})}catch(e){f({type:"error",title:"Error",message:"Error fetching device statuses"})}finally{y(!1)}},H=e=>{switch(e){case"online":return(0,a.jsx)(c.Z,{className:"h-6 w-6 text-green-500"});case"offline":return(0,a.jsx)(d.Z,{className:"h-6 w-6 text-red-500"});case"error":return(0,a.jsx)(o.Z,{className:"h-6 w-6 text-yellow-500"});default:return(0,a.jsx)(d.Z,{className:"h-6 w-6 text-gray-500"})}},B=e=>{switch(e){case"online":return"bg-green-100 text-green-800 border-green-200";case"offline":return"bg-red-100 text-red-800 border-red-200";case"error":return"bg-yellow-100 text-yellow-800 border-yellow-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},D=e=>e>=90?"bg-red-500":e>=75?"bg-yellow-500":"bg-green-500",W=j.filter(e=>{let s=e.nama.toLowerCase().includes(S.toLowerCase())||e.device_id.toLowerCase().includes(S.toLowerCase())||e.cabang.toLowerCase().includes(S.toLowerCase()),t=!C||e.latest_status===C;return s&&t}),F=j.filter(e=>"online"===e.latest_status).length,I=j.filter(e=>"offline"===e.latest_status).length,V=j.filter(e=>"error"===e.latest_status).length;return t||p?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,a.jsx)("div",{className:"container mx-auto px-4 py-8",children:(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-primary-600"})})})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50",children:(0,a.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Device Monitoring"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Real-time status monitoring of fingerprint devices"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("input",{type:"checkbox",id:"autoRefresh",checked:k,onChange:e=>E(e.target.checked),className:"rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,a.jsx)("label",{htmlFor:"autoRefresh",className:"text-sm text-gray-700",children:"Auto Refresh"})]}),(0,a.jsxs)("select",{value:Z,onChange:e=>L(parseInt(e.target.value)),disabled:!k,className:"px-3 py-1 border border-gray-300 rounded-md text-sm disabled:opacity-50",children:[(0,a.jsx)("option",{value:10,children:"10s"}),(0,a.jsx)("option",{value:30,children:"30s"}),(0,a.jsx)("option",{value:60,children:"1m"}),(0,a.jsx)("option",{value:300,children:"5m"})]}),(0,a.jsxs)("button",{onClick:R,className:"bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 flex items-center gap-2",children:[(0,a.jsx)(m.Z,{className:"h-4 w-4"}),"Refresh"]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Total Devices"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:j.length})]}),(0,a.jsx)(x.Z,{className:"h-8 w-8 text-gray-400"})]})}),(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Online"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-green-600",children:F})]}),(0,a.jsx)(c.Z,{className:"h-8 w-8 text-green-400"})]})}),(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Offline"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-red-600",children:I})]}),(0,a.jsx)(d.Z,{className:"h-8 w-8 text-red-400"})]})}),(0,a.jsx)("div",{className:"bg-white p-6 rounded-lg shadow-sm border",children:(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-600",children:"Errors"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-yellow-600",children:V})]}),(0,a.jsx)(o.Z,{className:"h-8 w-8 text-yellow-400"})]})})]}),(0,a.jsx)("div",{className:"bg-white p-4 rounded-lg shadow-sm border",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsx)("div",{children:(0,a.jsx)("input",{type:"text",placeholder:"Search devices...",value:S,onChange:e=>O(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})}),(0,a.jsx)("div",{children:(0,a.jsxs)("select",{value:C,onChange:e=>M(e.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"",children:"All Status"}),(0,a.jsx)("option",{value:"online",children:"Online"}),(0,a.jsx)("option",{value:"offline",children:"Offline"}),(0,a.jsx)("option",{value:"error",children:"Error"})]})}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{onClick:()=>{O(""),M("")},className:"w-full px-3 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200",children:"Clear Filters"})})]})}),(0,a.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:W.map(e=>(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow-sm border-2 p-6 cursor-pointer hover:shadow-md transition-shadow ".concat(B(e.latest_status)),onClick:()=>{N(e),_(!0)},children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[H(e.latest_status),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900",children:e.nama}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:e.device_id})]})]}),(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full ".concat(B(e.latest_status)),children:e.latest_status})]}),(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,a.jsx)(h.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:e.cabang})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,a.jsx)(u.Z,{className:"h-4 w-4"}),(0,a.jsxs)("span",{children:["Last sync: ",new Date(e.latest_sync).toLocaleString()]})]}),e.firmware_version&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[(0,a.jsx)(g.Z,{className:"h-4 w-4"}),(0,a.jsxs)("span",{children:["FW: ",e.firmware_version]})]}),(0,a.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,a.jsxs)("span",{className:"text-gray-600",children:["Employees: ",e.employee_count]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Storage:"}),(0,a.jsx)("div",{className:"w-16 bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"h-2 rounded-full ".concat(D(e.storage_usage)),style:{width:"".concat(e.storage_usage,"%")}})}),(0,a.jsxs)("span",{className:"text-xs text-gray-500",children:[e.storage_usage,"%"]})]})]}),e.error_message&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-2",children:(0,a.jsx)("p",{className:"text-xs text-red-700",children:e.error_message})})]})]},e.device_id))}),0===W.length&&(0,a.jsxs)("div",{className:"text-center py-12",children:[(0,a.jsx)(x.Z,{className:"mx-auto h-12 w-12 text-gray-400"}),(0,a.jsx)("h3",{className:"mt-2 text-sm font-medium text-gray-900",children:"No devices found"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-500",children:"No devices match your current filters."})]})]}),b&&w&&(0,a.jsx)("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:(0,a.jsx)("div",{className:"relative top-20 mx-auto p-5 border w-full max-w-4xl shadow-lg rounded-md bg-white",children:(0,a.jsxs)("div",{className:"mt-3",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsxs)("h3",{className:"text-lg font-medium text-gray-900",children:["Device Details: ",w.nama]}),(0,a.jsx)("button",{onClick:()=>_(!1),className:"text-gray-400 hover:text-gray-600",children:(0,a.jsx)(d.Z,{className:"h-6 w-6"})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"font-semibold text-gray-900",children:"Device Information"}),(0,a.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg space-y-2",children:[(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Device ID:"}),(0,a.jsx)("span",{className:"font-medium",children:w.device_id})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Type:"}),(0,a.jsx)("span",{className:"font-medium",children:w.tipe})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Branch:"}),(0,a.jsx)("span",{className:"font-medium",children:w.cabang})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Status:"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[H(w.latest_status),(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full ".concat(B(w.latest_status)),children:w.latest_status})]})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Firmware:"}),(0,a.jsx)("span",{className:"font-medium",children:w.firmware_version||"N/A"})]}),(0,a.jsxs)("div",{className:"flex justify-between",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Employees:"}),(0,a.jsx)("span",{className:"font-medium",children:w.employee_count})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("span",{className:"text-gray-600",children:"Storage Usage:"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-20 bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"h-2 rounded-full ".concat(D(w.storage_usage)),style:{width:"".concat(w.storage_usage,"%")}})}),(0,a.jsxs)("span",{className:"text-sm font-medium",children:[w.storage_usage,"%"]})]})]})]})]}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h4",{className:"font-semibold text-gray-900",children:"Sync History (Last 24h)"}),(0,a.jsx)("div",{className:"bg-gray-50 p-4 rounded-lg max-h-80 overflow-y-auto",children:w.sync_history.length>0?(0,a.jsx)("div",{className:"space-y-2",children:w.sync_history.map((e,s)=>(0,a.jsxs)("div",{className:"flex items-center justify-between py-2 border-b border-gray-200 last:border-b-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[H(e.status),(0,a.jsx)("span",{className:"text-sm font-medium",children:e.status})]}),(0,a.jsxs)("div",{className:"text-right",children:[(0,a.jsx)("div",{className:"text-xs text-gray-500",children:new Date(e.timestamp).toLocaleString()}),e.error_message&&(0,a.jsx)("div",{className:"text-xs text-red-600 mt-1",children:e.error_message})]})]},s))}):(0,a.jsx)("p",{className:"text-sm text-gray-500 text-center py-4",children:"No sync history available"})})]})]}),w.error_message&&(0,a.jsxs)("div",{className:"mt-6",children:[(0,a.jsx)("h4",{className:"font-semibold text-gray-900 mb-2",children:"Latest Error"}),(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,a.jsx)("p",{className:"text-sm text-red-700",children:w.error_message})})]}),(0,a.jsx)("div",{className:"flex justify-end mt-6",children:(0,a.jsx)("button",{onClick:()=>_(!1),className:"px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200",children:"Close"})})]})})})]})})}},1429:function(e,s,t){"use strict";var a=t(7294);let r=a.forwardRef(function(e,s){let{title:t,titleId:r,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":r},l),t?a.createElement("title",{id:r},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))});s.Z=r},6162:function(e,s,t){"use strict";var a=t(7294);let r=a.forwardRef(function(e,s){let{title:t,titleId:r,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":r},l),t?a.createElement("title",{id:r},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))});s.Z=r},3994:function(e,s,t){"use strict";var a=t(7294);let r=a.forwardRef(function(e,s){let{title:t,titleId:r,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":r},l),t?a.createElement("title",{id:r},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.25 3v1.5M4.5 8.25H3m18 0h-1.5M4.5 12H3m18 0h-1.5m-15 3.75H3m18 0h-1.5M8.25 19.5V21M12 3v1.5m0 15V21m3.75-18v1.5m0 15V21m-9-1.5h10.5a2.25 2.25 0 0 0 2.25-2.25V6.75a2.25 2.25 0 0 0-2.25-2.25H6.75A2.25 2.25 0 0 0 4.5 6.75v10.5a2.25 2.25 0 0 0 2.25 2.25Zm.75-12h9v9h-9v-9Z"}))});s.Z=r},3431:function(e,s,t){"use strict";var a=t(7294);let r=a.forwardRef(function(e,s){let{title:t,titleId:r,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":r},l),t?a.createElement("title",{id:r},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"}))});s.Z=r},7355:function(e,s,t){"use strict";var a=t(7294);let r=a.forwardRef(function(e,s){let{title:t,titleId:r,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":r},l),t?a.createElement("title",{id:r},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21.75 17.25v-.228a4.5 4.5 0 0 0-.12-1.03l-2.268-9.64a3.375 3.375 0 0 0-3.285-2.602H7.923a3.375 3.375 0 0 0-3.285 2.602l-2.268 9.64a4.5 4.5 0 0 0-.12 1.03v.228m19.5 0a3 3 0 0 1-3 3H5.25a3 3 0 0 1-3-3m19.5 0a3 3 0 0 0-3-3H5.25a3 3 0 0 0-3 3m16.5 0h.008v.008h-.008v-.008Zm-3 0h.008v.008h-.008v-.008Z"}))});s.Z=r},1771:function(e,s,t){"use strict";var a=t(7294);let r=a.forwardRef(function(e,s){let{title:t,titleId:r,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":r},l),t?a.createElement("title",{id:r},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9.348 14.652a3.75 3.75 0 0 1 0-5.304m5.304 0a3.75 3.75 0 0 1 0 5.304m-7.425 2.121a6.75 6.75 0 0 1 0-9.546m9.546 0a6.75 6.75 0 0 1 0 9.546M5.106 18.894c-3.808-3.807-3.808-9.98 0-13.788m13.788 0c3.808 3.807 3.808 9.98 0 13.788M12 12h.008v.008H12V12Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z"}))});s.Z=r},3781:function(e,s,t){"use strict";var a=t(7294);let r=a.forwardRef(function(e,s){let{title:t,titleId:r,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":r},l),t?a.createElement("title",{id:r},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M8.288 15.038a5.25 5.25 0 0 1 7.424 0M5.106 11.856c3.807-3.808 9.98-3.808 13.788 0M1.924 8.674c5.565-5.565 14.587-5.565 20.152 0M12.53 18.22l-.53.53-.53-.53a.75.75 0 0 1 1.06 0Z"}))});s.Z=r},9711:function(e,s,t){"use strict";var a=t(7294);let r=a.forwardRef(function(e,s){let{title:t,titleId:r,...l}=e;return a.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":r},l),t?a.createElement("title",{id:r},t):null,a.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))});s.Z=r}},function(e){e.O(0,[888,774,179],function(){return e(e.s=7144)}),_N_E=e.O()}]);