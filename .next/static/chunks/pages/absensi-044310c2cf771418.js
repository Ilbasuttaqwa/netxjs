(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[570],{4463:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/absensi",function(){return a(8621)}])},8621:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return b}});var t=a(5893),r=a(7294),n=a(9008),l=a.n(n),i=a(5770),d=a(1163),c=a(6458),m=a(889),o=a(8154),u=a(4410),x=a(1429),g=a(3431),h=a(9711);let j=r.forwardRef(function(e,s){let{title:a,titleId:t,...n}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),a?r.createElement("title",{id:t},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"}),r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z"}))});var f=a(3854);let v=r.forwardRef(function(e,s){let{title:a,titleId:t,...n}=e;return r.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":t},n),a?r.createElement("title",{id:t},a):null,r.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15M12 9l-3 3m0 0 3 3m-3-3h12.75"}))});var p=a(6162),N=a(7530),b=()=>{let{user:e,isAuthenticated:s,isLoading:a}=(0,i.a)(),n=(0,d.useRouter)(),{addToast:b}=(0,m.p)(),[k,w]=(0,r.useState)(null),[y,_]=(0,r.useState)([]),[E,S]=(0,r.useState)(!0),[Z,I]=(0,r.useState)(!1),[L,A]=(0,r.useState)(!1),[C,D]=(0,r.useState)(new Date),[M,B]=(0,r.useState)(null),[G,O]=(0,r.useState)("");(0,r.useEffect)(()=>{a||s||n.push("/login")},[s,a,n]),(0,r.useEffect)(()=>{s&&(T(),P(),z())},[s]),(0,r.useEffect)(()=>{let e=setInterval(()=>{D(new Date)},1e3);return()=>clearInterval(e)},[]);let z=()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{B({lat:e.coords.latitude,lng:e.coords.longitude}),O("")},e=>{O("Gagal mendapatkan lokasi. Pastikan GPS aktif.")}):O("Browser tidak mendukung geolocation.")},T=async()=>{try{let e=new Date().toISOString().split("T")[0],s=await c.rG.getByDate(e);s.success&&s.data?w(s.data):w(null)}catch(a){let s=new Date().toISOString().split("T")[0];"2024-01-15"===s?w({id:1,karyawan_id:(null==e?void 0:e.id)||1,tanggal:s,jam_masuk:"08:00:00",jam_keluar:void 0,status:"hadir",keterangan:"",created_at:"2024-01-15 08:00:00",updated_at:"2024-01-15 08:00:00"}):w(null)}},P=async()=>{try{S(!0);let s=await c.rG.getMyAttendance({limit:7});s.success&&s.data?_(s.data.data||[]):_([{id:1,karyawan_id:(null==e?void 0:e.id)||1,tanggal:"2024-01-15",jam_masuk:"08:00:00",jam_keluar:"17:00:00",status:"hadir",keterangan:"",created_at:"2024-01-15 08:00:00",updated_at:"2024-01-15 17:00:00"},{id:2,karyawan_id:(null==e?void 0:e.id)||1,tanggal:"2024-01-14",jam_masuk:"08:30:00",jam_keluar:"17:00:00",status:"terlambat",keterangan:"Terlambat 30 menit",created_at:"2024-01-14 08:30:00",updated_at:"2024-01-14 17:00:00"},{id:3,karyawan_id:(null==e?void 0:e.id)||1,tanggal:"2024-01-13",jam_masuk:void 0,jam_keluar:void 0,status:"alpha",keterangan:"Tidak hadir tanpa keterangan",created_at:"2024-01-13 00:00:00",updated_at:"2024-01-13 00:00:00"}])}catch(e){b({type:"error",title:"Error",message:e.message||"Gagal memuat riwayat absensi"})}finally{S(!1)}},R=async()=>{if(!M){b({type:"error",title:"Error",message:"Lokasi diperlukan untuk absen masuk"});return}try{I(!0);let e=await c.rG.clockIn({latitude:M.lat,longitude:M.lng});if(e.success)b({type:"success",title:"Berhasil",message:"Absen masuk berhasil dicatat"}),T(),P();else throw Error(e.message)}catch(e){b({type:"error",title:"Error",message:e.message||"Gagal melakukan absen masuk"})}finally{I(!1)}},F=async()=>{if(!M){b({type:"error",title:"Error",message:"Lokasi diperlukan untuk absen keluar"});return}try{A(!0);let e=await c.rG.clockOut({latitude:M.lat,longitude:M.lng});if(e.success)b({type:"success",title:"Berhasil",message:"Absen keluar berhasil dicatat"}),T(),P();else throw Error(e.message)}catch(e){b({type:"error",title:"Error",message:e.message||"Gagal melakukan absen keluar"})}finally{A(!1)}},K=e=>{switch(e){case"hadir":return(0,t.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-success-100 text-success-800",children:[(0,t.jsx)(x.Z,{className:"h-3 w-3 mr-1"}),"Hadir"]});case"terlambat":return(0,t.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-warning-100 text-warning-800",children:[(0,t.jsx)(g.Z,{className:"h-3 w-3 mr-1"}),"Terlambat"]});case"alpha":return(0,t.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-danger-100 text-danger-800",children:[(0,t.jsx)(h.Z,{className:"h-3 w-3 mr-1"}),"Alpha"]});case"izin":return(0,t.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800",children:[(0,t.jsx)(x.Z,{className:"h-3 w-3 mr-1"}),"Izin"]});case"sakit":return(0,t.jsxs)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-800",children:[(0,t.jsx)(x.Z,{className:"h-3 w-3 mr-1"}),"Sakit"]});default:return(0,t.jsx)("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800",children:e})}},H=e=>new Date(e).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),W=e=>e?e.substring(0,5):"-";return a||!s?(0,t.jsx)("div",{className:"min-h-screen flex items-center justify-center",children:(0,t.jsx)("div",{className:"loading-spinner w-8 h-8"})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(l(),{children:[(0,t.jsx)("title",{children:"Absensi - AFMS"}),(0,t.jsx)("meta",{name:"description",content:"Sistem absensi karyawan"})]}),(0,t.jsx)(o.Z,{children:(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsx)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsxs)("h1",{className:"text-2xl font-bold text-gray-900",children:["Selamat Datang, ",null==e?void 0:e.name]}),(0,t.jsx)("p",{className:"text-gray-600 mt-1",children:C.toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}),(0,t.jsx)("div",{className:"text-3xl font-mono font-bold text-primary-600 mt-2",children:C.toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit",second:"2-digit"})})]})}),(0,t.jsx)("div",{className:"bg-white shadow-sm rounded-lg p-6",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Absensi Hari Ini"}),G&&(0,t.jsxs)("div",{className:"mb-4 p-3 bg-warning-50 border border-warning-200 rounded-md",children:[(0,t.jsxs)("div",{className:"flex items-center",children:[(0,t.jsx)(g.Z,{className:"h-5 w-5 text-warning-400 mr-2"}),(0,t.jsx)("span",{className:"text-sm text-warning-700",children:G})]}),(0,t.jsx)(u.z,{variant:"outline",size:"sm",onClick:z,className:"mt-2",leftIcon:(0,t.jsx)(j,{className:"h-4 w-4"}),children:"Coba Lagi"})]}),M&&(0,t.jsx)("div",{className:"mb-4 p-3 bg-success-50 border border-success-200 rounded-md",children:(0,t.jsxs)("div",{className:"flex items-center justify-center",children:[(0,t.jsx)(j,{className:"h-5 w-5 text-success-400 mr-2"}),(0,t.jsxs)("span",{className:"text-sm text-success-700",children:["Lokasi terdeteksi: ",M.lat.toFixed(6),", ",M.lng.toFixed(6)]})]})}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-w-md mx-auto",children:[(null==k?void 0:k.jam_masuk)?(0,t.jsx)("div",{className:"h-20 bg-success-50 border-2 border-success-200 rounded-lg flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(x.Z,{className:"h-6 w-6 text-success-600 mx-auto mb-1"}),(0,t.jsxs)("div",{className:"text-sm font-medium text-success-800",children:["Masuk: ",W(k.jam_masuk)]})]})}):(0,t.jsx)(u.z,{onClick:R,loading:Z,disabled:!M,size:"lg",className:"h-20",leftIcon:(0,t.jsx)(f.Z,{className:"h-6 w-6"}),children:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-semibold",children:"Absen Masuk"}),(0,t.jsx)("div",{className:"text-sm opacity-75",children:"Clock In"})]})}),(null==k?void 0:k.jam_masuk)&&!(null==k?void 0:k.jam_keluar)?(0,t.jsx)(u.z,{onClick:F,loading:L,disabled:!M,variant:"destructive",size:"lg",className:"h-20",leftIcon:(0,t.jsx)(v,{className:"h-6 w-6"}),children:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"font-semibold",children:"Absen Keluar"}),(0,t.jsx)("div",{className:"text-sm opacity-75",children:"Clock Out"})]})}):(null==k?void 0:k.jam_keluar)?(0,t.jsx)("div",{className:"h-20 bg-danger-50 border-2 border-danger-200 rounded-lg flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)(x.Z,{className:"h-6 w-6 text-danger-600 mx-auto mb-1"}),(0,t.jsxs)("div",{className:"text-sm font-medium text-danger-800",children:["Keluar: ",W(k.jam_keluar)]})]})}):(0,t.jsx)("div",{className:"h-20 bg-gray-50 border-2 border-gray-200 rounded-lg flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center text-gray-500",children:[(0,t.jsx)(p.Z,{className:"h-6 w-6 mx-auto mb-1"}),(0,t.jsx)("div",{className:"text-sm",children:"Belum Absen Masuk"})]})})]}),k&&(0,t.jsxs)("div",{className:"mt-4 p-4 bg-gray-50 rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center justify-center space-x-4",children:[(0,t.jsx)("span",{className:"text-sm text-gray-600",children:"Status Hari Ini:"}),K(k.status)]}),k.keterangan&&(0,t.jsxs)("div",{className:"mt-2 text-sm text-gray-600",children:["Keterangan: ",k.keterangan]})]})]})}),(0,t.jsxs)("div",{className:"bg-white shadow-sm rounded-lg overflow-hidden",children:[(0,t.jsx)("div",{className:"px-6 py-4 border-b border-gray-200",children:(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"Riwayat Absensi"})}),E?(0,t.jsx)("div",{className:"p-6",children:(0,t.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0].map((e,s)=>(0,t.jsx)("div",{className:"animate-pulse",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsx)("div",{className:"h-10 w-10 bg-gray-200 rounded-lg"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"h-4 bg-gray-200 rounded w-32 mb-2"}),(0,t.jsx)("div",{className:"h-3 bg-gray-200 rounded w-24"})]})]}),(0,t.jsx)("div",{className:"h-6 w-16 bg-gray-200 rounded"})]})},s))})}):(0,t.jsx)("div",{className:"divide-y divide-gray-200",children:0===y.length?(0,t.jsx)("div",{className:"p-6 text-center text-gray-500",children:"Belum ada riwayat absensi"}):y.map(e=>(0,t.jsx)("div",{className:"p-6 hover:bg-gray-50 transition-colors",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)("div",{className:"h-10 w-10 bg-primary-100 rounded-lg flex items-center justify-center",children:(0,t.jsx)(N.Z,{className:"h-5 w-5 text-primary-600"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"text-sm font-medium text-gray-900",children:H(e.tanggal)}),(0,t.jsxs)("div",{className:"text-sm text-gray-500 flex items-center space-x-4",children:[(0,t.jsxs)("span",{className:"flex items-center",children:[(0,t.jsx)(p.Z,{className:"h-3 w-3 mr-1"}),"Masuk: ",W(e.jam_masuk)]}),(0,t.jsxs)("span",{className:"flex items-center",children:[(0,t.jsx)(p.Z,{className:"h-3 w-3 mr-1"}),"Keluar: ",W(e.jam_keluar)]})]})]})]}),(0,t.jsxs)("div",{className:"text-right",children:[K(e.status),e.keterangan&&(0,t.jsx)("div",{className:"text-xs text-gray-500 mt-1",children:e.keterangan})]})]})},e.id))})]})]})})]})}},9711:function(e,s,a){"use strict";var t=a(7294);let r=t.forwardRef(function(e,s){let{title:a,titleId:r,...n}=e;return t.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:s,"aria-labelledby":r},n),a?t.createElement("title",{id:r},a):null,t.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))});s.Z=r}},function(e){e.O(0,[474,151,154,888,774,179],function(){return e(e.s=4463)}),_N_E=e.O()}]);