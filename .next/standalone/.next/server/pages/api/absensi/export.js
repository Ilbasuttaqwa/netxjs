"use strict";(()=>{var a={};a.id=2362,a.ids=[2362],a.modules={9344:a=>{a.exports=require("jsonwebtoken")},145:a=>{a.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(a,e)=>{Object.defineProperty(e,"l",{enumerable:!0,get:function(){return function a(e,t){return t in e?e[t]:"then"in e&&"function"==typeof e.then?e.then(e=>a(e,t)):"function"==typeof e&&"default"===t?e:void 0}}})},5405:(a,e,t)=>{t.r(e),t.d(e,{config:()=>g,default:()=>m,routeModule:()=>k});var n={};t.r(n),t.d(n,{default:()=>c});var r=t(1802),s=t(7153),i=t(6249),o=t(7777);let u=require("xlsx"),l=[{id:1,karyawan_id:1,nama_karyawan:"John Doe",cabang:"Kantor Pusat",tanggal:"2024-01-15",jam_masuk:"08:00:00",jam_keluar:"17:00:00",status:"hadir",keterangan:""},{id:2,karyawan_id:2,nama_karyawan:"Jane Smith",cabang:"Kantor Pusat",tanggal:"2024-01-15",jam_masuk:"08:30:00",jam_keluar:"17:00:00",status:"terlambat",keterangan:"Terlambat 30 menit"},{id:3,karyawan_id:3,nama_karyawan:"Bob Johnson",cabang:"Cabang A",tanggal:"2024-01-15",jam_masuk:void 0,jam_keluar:void 0,status:"alpha",keterangan:"Tidak hadir tanpa keterangan"},{id:4,karyawan_id:1,nama_karyawan:"John Doe",cabang:"Kantor Pusat",tanggal:"2024-01-14",jam_masuk:"08:00:00",jam_keluar:"17:00:00",status:"hadir",keterangan:""},{id:5,karyawan_id:4,nama_karyawan:"Alice Brown",cabang:"Cabang B",tanggal:"2024-01-14",jam_masuk:"08:00:00",jam_keluar:"16:00:00",status:"izin",keterangan:"Izin pulang cepat"}];async function d(a,e){if("GET"!==a.method)return e.status(405).json({success:!1,message:"Method not allowed"});try{let{tanggal_mulai:t,tanggal_selesai:n,cabang_id:r,karyawan_id:s,status:i}=a.query,o=[...l];t&&(o=o.filter(a=>a.tanggal>=t)),n&&(o=o.filter(a=>a.tanggal<=n)),s&&(o=o.filter(a=>a.karyawan_id===parseInt(s))),i&&(o=o.filter(a=>a.status===i));let d=o.map((a,e)=>({No:e+1,"Nama Karyawan":a.nama_karyawan,Cabang:a.cabang,Tanggal:a.tanggal,"Jam Masuk":a.jam_masuk||"-","Jam Keluar":a.jam_keluar||"-",Status:a.status.charAt(0).toUpperCase()+a.status.slice(1),Keterangan:a.keterangan||"-"})),c=u.utils.book_new(),m=u.utils.json_to_sheet(d);m["!cols"]=[{wch:5},{wch:20},{wch:15},{wch:12},{wch:12},{wch:12},{wch:12},{wch:30}],u.utils.book_append_sheet(c,m,"Laporan Absensi");let g=u.write(c,{type:"buffer",bookType:"xlsx"}),k=`laporan-absensi-${new Date().toISOString().split("T")[0]}.xlsx`;e.setHeader("Content-Type","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"),e.setHeader("Content-Disposition",`attachment; filename="${k}"`),e.setHeader("Content-Length",g.length),e.status(200).send(g)}catch(a){return e.status(500).json({success:!1,message:"Gagal mengexport data ke Excel",error:void 0})}}let c=(0,o.M)(["admin"])(d),m=(0,i.l)(n,"default"),g=(0,i.l)(n,"config"),k=new r.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/absensi/export",pathname:"/api/absensi/export",bundlePath:"",filename:""},userland:n})},7777:(a,e,t)=>{t.d(e,{M:()=>s});var n=t(9344),r=t.n(n);function s(a){return function(e){var t;return t=async(t,n)=>t.user&&a.includes(t.user.role)?e(t,n):n.status(403).json({error:"Akses ditolak"}),async(a,e)=>{try{let n=a.headers.authorization?.replace("Bearer ","")||a.cookies.token;if(!n)return e.status(401).json({error:"Token tidak ditemukan"});let s=r().verify(n,"afms-production-jwt-secret-key-2024-ultra-secure-random-string-xyz789");return a.user=s,t(a,e)}catch(a){return e.status(401).json({error:"Token tidak valid"})}}}}},7153:(a,e)=>{var t;Object.defineProperty(e,"x",{enumerable:!0,get:function(){return t}}),function(a){a.PAGES="PAGES",a.PAGES_API="PAGES_API",a.APP_PAGE="APP_PAGE",a.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(a,e,t)=>{a.exports=t(145)}};var e=require("../../../webpack-api-runtime.js");e.C(a);var t=e(e.s=5405);module.exports=t})();