"use strict";(()=>{var a={};a.id=4404,a.ids=[4404],a.modules={9344:a=>{a.exports=require("jsonwebtoken")},145:a=>{a.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(a,e)=>{Object.defineProperty(e,"l",{enumerable:!0,get:function(){return function a(e,t){return t in e?e[t]:"then"in e&&"function"==typeof e.then?e.then(e=>a(e,t)):"function"==typeof e&&"default"===t?e:void 0}}})},5905:(a,e,t)=>{t.r(e),t.d(e,{config:()=>k,default:()=>c,routeModule:()=>g});var r={};t.r(r),t.d(r,{default:()=>m});var s=t(1802),n=t(7153),u=t(6249),i=t(3382);let o=[{id:1,karyawan_id:1,karyawan:{nama:"John Doe",email:"john@afms.com"},tanggal:"2024-01-15",jam_masuk:"08:00:00",jam_keluar:"17:00:00",status:"hadir",keterangan:"",lokasi_masuk:"Kantor Utama",lokasi_keluar:"Kantor Utama",created_at:"2024-01-15T08:00:00.000Z",updated_at:"2024-01-15T17:00:00.000Z"},{id:2,karyawan_id:2,karyawan:{nama:"Jane Smith",email:"jane@afms.com"},tanggal:"2024-01-15",jam_masuk:"08:15:00",jam_keluar:"17:00:00",status:"terlambat",keterangan:"Terlambat 15 menit",lokasi_masuk:"Kantor Utama",lokasi_keluar:"Kantor Utama",created_at:"2024-01-15T08:15:00.000Z",updated_at:"2024-01-15T17:00:00.000Z"},{id:3,karyawan_id:1,karyawan:{nama:"John Doe",email:"john@afms.com"},tanggal:"2024-01-16",jam_masuk:"07:55:00",jam_keluar:null,status:"hadir",keterangan:"",lokasi_masuk:"Kantor Utama",lokasi_keluar:null,created_at:"2024-01-16T07:55:00.000Z",updated_at:"2024-01-16T07:55:00.000Z"}],l=4;async function d(a,e){try{switch(a.method){case"GET":let{page:t=1,limit:r=10,tanggal_mulai:s,tanggal_selesai:n,karyawan_id:u,status:i,cabang_id:d}=a.query,m=[...o];a.user?.role!=="admin"&&(m=m.filter(e=>e.karyawan_id===a.user?.userId)),s&&(m=m.filter(a=>a.tanggal>=s)),n&&(m=m.filter(a=>a.tanggal<=n)),u&&a.user?.role==="admin"&&(m=m.filter(a=>a.karyawan_id===parseInt(u.toString()))),i&&(m=m.filter(a=>a.status===i));let c=parseInt(t.toString()),k=parseInt(r.toString()),g=(c-1)*k,f=m.slice(g,g+k);return e.status(200).json({success:!0,data:{data:f,current_page:c,per_page:k,total:m.length,last_page:Math.ceil(m.length/k)}});case"POST":let{type:_,lokasi:p,keterangan:j}=a.body;if(!_||!["masuk","keluar"].includes(_))return e.status(400).json({success:!1,message:'Type must be either "masuk" or "keluar"'});let y=new Date().toISOString().split("T")[0],h=new Date().toTimeString().split(" ")[0];if("masuk"===_){if(o.find(e=>e.karyawan_id===a.user?.userId&&e.tanggal===y))return e.status(400).json({success:!1,message:"Already clocked in today"});let t=h>"08:00:00"?"terlambat":"hadir",r={id:l++,karyawan_id:a.user?.userId,karyawan:{nama:"Current User",email:a.user?.email},tanggal:y,jam_masuk:h,jam_keluar:null,status:t,keterangan:j||("terlambat"===t?"Terlambat":""),lokasi_masuk:p||"Unknown",lokasi_keluar:null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return o.push(r),e.status(201).json({success:!0,message:"Clock in berhasil",data:r})}{let t=o.findIndex(e=>e.karyawan_id===a.user?.userId&&e.tanggal===y);if(-1===t)return e.status(400).json({success:!1,message:"No clock in record found for today"});if(o[t].jam_keluar)return e.status(400).json({success:!1,message:"Already clocked out today"});return o[t]={...o[t],jam_keluar:h,lokasi_keluar:p||"Unknown",updated_at:new Date().toISOString()},e.status(200).json({success:!0,message:"Clock out berhasil",data:o[t]})}default:return e.status(405).json({success:!1,message:"Method not allowed"})}}catch(a){return e.status(500).json({success:!1,message:"Terjadi kesalahan server",error:void 0})}}let m=(0,i.Q)(d),c=(0,u.l)(r,"default"),k=(0,u.l)(r,"config"),g=new s.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/absensi",pathname:"/api/absensi",bundlePath:"",filename:""},userland:r})},3382:(a,e,t)=>{t.d(e,{Q:()=>n,c:()=>u});var r=t(9344),s=t.n(r);function n(a,e){return async(t,r)=>{try{let n=t.headers.authorization;if(!n||!n.startsWith("Bearer "))return r.status(401).json({message:"No token provided"});let u=n.substring(7),i=s().verify(u,"afms-production-jwt-secret-key-2024-ultra-secure-random-string-xyz789");if(!i||!i.id)return r.status(401).json({message:"Token tidak valid"});if(t.user={id:i.id,userId:parseInt(i.id)||1,email:i.email||"",name:i.name||"",role:i.role||"admin"},e&&!(Array.isArray(e)?e:[e]).includes(t.user.role))return r.status(403).json({message:"Insufficient permissions"});return await a(t,r)}catch(a){return r.status(401).json({message:"Token tidak valid"})}}}function u(a){return n(a,"admin")}},7153:(a,e)=>{var t;Object.defineProperty(e,"x",{enumerable:!0,get:function(){return t}}),function(a){a.PAGES="PAGES",a.PAGES_API="PAGES_API",a.APP_PAGE="APP_PAGE",a.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(a,e,t)=>{a.exports=t(145)}};var e=require("../../webpack-api-runtime.js");e.C(a);var t=e(e.s=5905);module.exports=t})();