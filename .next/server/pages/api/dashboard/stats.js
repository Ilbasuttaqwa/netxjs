"use strict";(()=>{var e={};e.id=3106,e.ids=[3106],e.modules={3524:e=>{e.exports=require("@prisma/client")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,a)=>{Object.defineProperty(a,"l",{enumerable:!0,get:function(){return function e(a,t){return t in a?a[t]:"then"in a&&"function"==typeof a.then?a.then(a=>e(a,t)):"function"==typeof a&&"default"===t?a:void 0}}})},8254:(e,a,t)=>{t.r(a),t.d(a,{config:()=>c,default:()=>m,routeModule:()=>h});var r={};t.r(r),t.d(r,{default:()=>_});var n=t(1802),s=t(7153),i=t(6249),u=t(3382),o=t(1450);let l={admin:{total_karyawan:150,total_cabang:5,total_hadir_hari_ini:142,total_terlambat_hari_ini:8,total_alpha_hari_ini:0,persentase_kehadiran:94.7},user:{total_hadir_hari_ini:1,total_terlambat_hari_ini:0,jam_masuk:"08:00",jam_keluar:"17:00",status_hari_ini:"Hadir"}};async function d(e,a){if("GET"!==e.method)return a.status(405).json({message:"Method not allowed"});try{let t=e.user?.role,r=new Date;r.setHours(0,0,0,0);let n=new Date(r);if(n.setDate(n.getDate()+1),"admin"===t||"manager"===t)try{let[e,t,s]=await Promise.all([o._.user.count({where:{role:{not:"admin"}}}),o._.cabang.count(),o._.absensi.findMany({where:{tanggal:{gte:r,lt:n}},include:{user:{include:{jabatan:!0}}}})]),i=s.filter(e=>e.jam_masuk).length,u=s.filter(e=>{if(!e.jam_masuk||!e.user?.jabatan)return!1;let a=new Date(e.jam_masuk),t=new Date(e.user.jabatan.jam_masuk||"08:00");return a>t}).length;return a.status(200).json({success:!0,data:{total_karyawan:e,total_cabang:t,total_hadir_hari_ini:i,total_terlambat_hari_ini:u,total_alpha_hari_ini:e-i,persentase_kehadiran:e>0?Math.round(i/e*100):0}})}catch(e){return a.status(200).json({success:!0,data:l.admin})}else try{let t=await o._.absensi.findFirst({where:{id_user:BigInt(e.user?.id||0),tanggal:{gte:r,lt:n}},include:{user:{include:{jabatan:!0}}}}),s=t?.jam_masuk?"Hadir":"Belum Absen",i=t?.user?.jabatan?.jam_masuk||"08:00";return a.status(200).json({success:!0,data:{total_hadir_hari_ini:t?.jam_masuk?1:0,total_terlambat_hari_ini:0,jam_masuk:i,jam_keluar:"17:00",status_hari_ini:s}})}catch(e){return a.status(200).json({success:!0,data:l.user})}}catch(e){return a.status(500).json({message:"Internal server error"})}}let _=(0,u.Q)(d),m=(0,i.l)(r,"default"),c=(0,i.l)(r,"config"),h=new n.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/dashboard/stats",pathname:"/api/dashboard/stats",bundlePath:"",filename:""},userland:r})},3382:(e,a,t)=>{t.d(a,{Q:()=>s,c:()=>i});var r=t(9344),n=t.n(r);function s(e,a){return async(t,r)=>{try{let s=t.headers.authorization;if(!s||!s.startsWith("Bearer "))return r.status(401).json({message:"No token provided"});let i=s.substring(7),u=n().verify(i,"your-super-secret-jwt-key-here-development");if(!u||!u.id)return r.status(401).json({message:"Invalid token"});if(t.user={id:u.id,userId:parseInt(u.id)||1,email:u.email||"",name:u.name||"",role:u.role||"admin"},a&&!(Array.isArray(a)?a:[a]).includes(t.user.role))return r.status(403).json({message:"Insufficient permissions"});return await e(t,r)}catch(e){return r.status(401).json({message:"Invalid token"})}}}function i(e){return s(e,"admin")}},1450:(e,a,t)=>{t.d(a,{_:()=>n});var r=t(3524);let n=globalThis.prisma??new r.PrismaClient({log:["query"]})},7153:(e,a)=>{var t;Object.defineProperty(a,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,a,t)=>{e.exports=t(145)}};var a=require("../../../webpack-api-runtime.js");a.C(e);var t=a(a.s=8254);module.exports=t})();