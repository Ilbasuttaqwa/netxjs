"use strict";(()=>{var e={};e.id=8718,e.ids=[8718],e.modules={3524:e=>{e.exports=require("@prisma/client")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,a)=>{Object.defineProperty(a,"l",{enumerable:!0,get:function(){return function e(a,t){return t in a?a[t]:"then"in a&&"function"==typeof a.then?a.then(a=>e(a,t)):"function"==typeof a&&"default"===t?a:void 0}}})},8282:(e,a,t)=>{t.r(a),t.d(a,{config:()=>g,default:()=>l,routeModule:()=>m});var n={};t.r(n),t.d(n,{default:()=>d});var r=t(1802),s=t(7153),i=t(6249),u=t(9344),o=t.n(u);let c=new(t(3524)).PrismaClient;async function d(e,a){if("GET"!==e.method)return a.status(405).json({success:!1,message:"Method not allowed"});try{let t=e.headers.authorization,n=t?.replace("Bearer ","")||e.cookies["auth-token"];if(!n)return a.status(401).json({success:!1,message:"Token tidak ditemukan"});let r=o().verify(n,"afms-jwt-secret-key-2024"),s=await c.user.findUnique({where:{id:Number(r.id)},include:{cabang:!0}});if(!s)return a.status(404).json({success:!1,message:"User tidak ditemukan"});let i={id:s.id.toString(),nama_pegawai:s.nama_pegawai,role:s.role,id_cabang:s.id_cabang?.toString(),cabang:s.cabang?{id:s.cabang.id.toString(),nama_cabang:s.cabang.nama_cabang,alamat_cabang:s.cabang.alamat_cabang,telepon_cabang:s.cabang.telepon_cabang}:null,created_at:s.created_at,updated_at:s.updated_at};return a.status(200).json({success:!0,message:"Profile berhasil diambil",data:i})}catch(e){if("JsonWebTokenError"===e.name)return a.status(401).json({success:!1,message:"Token tidak valid"});if("TokenExpiredError"===e.name)return a.status(401).json({success:!1,message:"Token sudah expired"});return a.status(500).json({success:!1,message:"Terjadi kesalahan server"})}finally{await c.$disconnect()}}let l=(0,i.l)(n,"default"),g=(0,i.l)(n,"config"),m=new r.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/auth/profile",pathname:"/api/auth/profile",bundlePath:"",filename:""},userland:n})},7153:(e,a)=>{var t;Object.defineProperty(a,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,a,t)=>{e.exports=t(145)}};var a=require("../../../webpack-api-runtime.js");a.C(e);var t=a(a.s=8282);module.exports=t})();