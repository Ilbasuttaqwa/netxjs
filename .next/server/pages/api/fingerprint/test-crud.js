"use strict";(()=>{var e={};e.id=5985,e.ids=[5985],e.modules={3524:e=>{e.exports=require("@prisma/client")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,s){return s in t?t[s]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,s)):"function"==typeof t&&"default"===s?t:void 0}}})},234:(e,t,s)=>{s.r(t),s.d(t,{config:()=>f,default:()=>E,routeModule:()=>D});var a={};s.r(a),s.d(a,{default:()=>g});var r=s(1802),n=s(7153),i=s(6249),c=s(3382);let o=new(s(3524)).PrismaClient,d=async(e,t)=>{try{switch(e.method){case"POST":return await u(e,t);case"GET":return await p(e,t);case"PUT":return await _(e,t);case"DELETE":return await m(e,t);default:return t.status(405).json({success:!1,message:"Method tidak diizinkan"})}}catch(e){return t.status(500).json({success:!1,message:"Internal server error",errors:{general:[e.message]}})}finally{await o.$disconnect()}};async function u(e,t){let s=[];try{let a={device_id:e.body.device_id||"TEST_DEVICE_001",user_id:e.body.user_id||"1",timestamp:e.body.timestamp||new Date().toISOString(),verify_type:e.body.verify_type||1,in_out_mode:e.body.in_out_mode||1,test_mode:!0};try{let e=await o.fingerprintAttendance.create({data:{user_id:parseInt(a.user_id),device_user_id:a.user_id,device_id:a.device_id,attendance_time:new Date(a.timestamp),attendance_type:a.in_out_mode,verification_type:l(a.verify_type),is_realtime:!1,processing_status:"test_mode",created_at:new Date,updated_at:new Date}});s.push({operation:"CREATE_BASIC",success:!0,data:e,timestamp:new Date().toISOString()})}catch(e){s.push({operation:"CREATE_BASIC",success:!1,error:e.message,timestamp:new Date().toISOString()})}try{let e=await o.fingerprintAttendance.create({data:{user_id:parseInt(a.user_id),device_user_id:a.user_id,device_id:a.device_id,attendance_time:new Date(a.timestamp),attendance_type:a.in_out_mode,verification_type:l(a.verify_type),is_realtime:!0,processing_status:"validated",created_at:new Date,updated_at:new Date}});s.push({operation:"CREATE_VALIDATED",success:!0,data:e,timestamp:new Date().toISOString()})}catch(e){s.push({operation:"CREATE_VALIDATED",success:!1,error:e.message,timestamp:new Date().toISOString()})}try{let e=[];for(let t=0;t<5;t++){let s=new Date;s.setMinutes(s.getMinutes()+t),e.push({user_id:parseInt(a.user_id)+t,device_user_id:(parseInt(a.user_id)+t).toString(),device_id:a.device_id,attendance_time:s,attendance_type:t%2,verification_type:l(a.verify_type),is_realtime:!1,processing_status:"bulk_test",created_at:new Date,updated_at:new Date})}let t=await o.fingerprintAttendance.createMany({data:e});s.push({operation:"CREATE_BULK",success:!0,data:{count:t.count},timestamp:new Date().toISOString()})}catch(e){s.push({operation:"CREATE_BULK",success:!1,error:e.message,timestamp:new Date().toISOString()})}return t.status(200).json({success:!0,message:"CREATE operations test completed",data:{test_results:s,summary:{total_tests:s.length,passed:s.filter(e=>e.success).length,failed:s.filter(e=>!e.success).length}}})}catch(e){return t.status(500).json({success:!1,message:"CREATE test failed",errors:{general:[e.message]}})}}async function p(e,t){let s=[];try{try{let e=await o.fingerprintAttendance.findMany({take:10,orderBy:{created_at:"desc"}});s.push({operation:"READ_ALL",success:!0,data:{count:e.length,records:e},timestamp:new Date().toISOString()})}catch(e){s.push({operation:"READ_ALL",success:!1,error:e.message,timestamp:new Date().toISOString()})}try{let e=new Date;e.setHours(0,0,0,0);let t=new Date(e);t.setDate(t.getDate()+1);let a=await o.fingerprintAttendance.findMany({where:{attendance_time:{gte:e,lt:t},processing_status:{in:["test_mode","validated","bulk_test"]}},include:{user:{select:{id:!0,nama_pegawai:!0,device_user_id:!0}}}});s.push({operation:"READ_FILTERED",success:!0,data:{count:a.length,records:a},timestamp:new Date().toISOString()})}catch(e){s.push({operation:"READ_FILTERED",success:!1,error:e.message,timestamp:new Date().toISOString()})}try{let e=await o.fingerprintAttendance.findMany({where:{device_id:"TEST_DEVICE_001"},orderBy:{attendance_time:"desc"},take:5});s.push({operation:"READ_BY_DEVICE",success:!0,data:{count:e.length,records:e},timestamp:new Date().toISOString()})}catch(e){s.push({operation:"READ_BY_DEVICE",success:!1,error:e.message,timestamp:new Date().toISOString()})}try{let t=parseInt(e.query.page)||1,a=parseInt(e.query.limit)||5,r=(t-1)*a,n=await o.fingerprintAttendance.findMany({skip:r,take:a,orderBy:{created_at:"desc"},where:{processing_status:{in:["test_mode","validated","bulk_test"]}}}),i=await o.fingerprintAttendance.count({where:{processing_status:{in:["test_mode","validated","bulk_test"]}}});s.push({operation:"READ_PAGINATED",success:!0,data:{records:n,pagination:{page:t,limit:a,total:i,total_pages:Math.ceil(i/a)}},timestamp:new Date().toISOString()})}catch(e){s.push({operation:"READ_PAGINATED",success:!1,error:e.message,timestamp:new Date().toISOString()})}return t.status(200).json({success:!0,message:"READ operations test completed",data:{test_results:s,summary:{total_tests:s.length,passed:s.filter(e=>e.success).length,failed:s.filter(e=>!e.success).length}}})}catch(e){return t.status(500).json({success:!1,message:"READ test failed",errors:{general:[e.message]}})}}async function _(e,t){let s=[];try{try{let e=await o.fingerprintAttendance.findFirst({where:{processing_status:{in:["test_mode","validated","bulk_test"]}}});if(e){let t=await o.fingerprintAttendance.update({where:{id:e.id},data:{processing_status:"updated_test",verification_type:"fingerprint_updated",updated_at:new Date}});s.push({operation:"UPDATE_SINGLE",success:!0,data:t,timestamp:new Date().toISOString()})}else s.push({operation:"UPDATE_SINGLE",success:!1,error:"No test record found to update",timestamp:new Date().toISOString()})}catch(e){s.push({operation:"UPDATE_SINGLE",success:!1,error:e.message,timestamp:new Date().toISOString()})}try{let e=await o.fingerprintAttendance.updateMany({where:{processing_status:"bulk_test"},data:{processing_status:"bulk_updated",updated_at:new Date}});s.push({operation:"UPDATE_BULK",success:!0,data:{count:e.count},timestamp:new Date().toISOString()})}catch(e){s.push({operation:"UPDATE_BULK",success:!1,error:e.message,timestamp:new Date().toISOString()})}try{let e=await o.fingerprintAttendance.updateMany({where:{device_id:"TEST_DEVICE_001",attendance_type:0,processing_status:{in:["test_mode","validated"]}},data:{processing_status:"conditional_updated",updated_at:new Date}});s.push({operation:"UPDATE_CONDITIONAL",success:!0,data:{count:e.count},timestamp:new Date().toISOString()})}catch(e){s.push({operation:"UPDATE_CONDITIONAL",success:!1,error:e.message,timestamp:new Date().toISOString()})}return t.status(200).json({success:!0,message:"UPDATE operations test completed",data:{test_results:s,summary:{total_tests:s.length,passed:s.filter(e=>e.success).length,failed:s.filter(e=>!e.success).length}}})}catch(e){return t.status(500).json({success:!1,message:"UPDATE test failed",errors:{general:[e.message]}})}}async function m(e,t){let s=[];try{try{let e=await o.fingerprintAttendance.findFirst({where:{processing_status:{in:["updated_test","conditional_updated"]}}});if(e){let t=await o.fingerprintAttendance.delete({where:{id:e.id}});s.push({operation:"DELETE_SINGLE",success:!0,data:{deleted_id:t.id},timestamp:new Date().toISOString()})}else s.push({operation:"DELETE_SINGLE",success:!1,error:"No test record found to delete",timestamp:new Date().toISOString()})}catch(e){s.push({operation:"DELETE_SINGLE",success:!1,error:e.message,timestamp:new Date().toISOString()})}try{let e=await o.fingerprintAttendance.deleteMany({where:{processing_status:{in:["bulk_updated","conditional_updated","updated_test"]}}});s.push({operation:"DELETE_BULK",success:!0,data:{count:e.count},timestamp:new Date().toISOString()})}catch(e){s.push({operation:"DELETE_BULK",success:!1,error:e.message,timestamp:new Date().toISOString()})}try{let e=await o.fingerprintAttendance.deleteMany({where:{device_id:"TEST_DEVICE_001",processing_status:{in:["test_mode","validated"]}}});s.push({operation:"DELETE_CONDITIONAL",success:!0,data:{count:e.count},timestamp:new Date().toISOString()})}catch(e){s.push({operation:"DELETE_CONDITIONAL",success:!1,error:e.message,timestamp:new Date().toISOString()})}return t.status(200).json({success:!0,message:"DELETE operations test completed",data:{test_results:s,summary:{total_tests:s.length,passed:s.filter(e=>e.success).length,failed:s.filter(e=>!e.success).length}}})}catch(e){return t.status(500).json({success:!1,message:"DELETE test failed",errors:{general:[e.message]}})}}function l(e){switch(e){case 1:default:return"fingerprint";case 15:return"face";case 2:return"card"}}let g=(0,c.Q)(d),E=(0,i.l)(a,"default"),f=(0,i.l)(a,"config"),D=new r.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/fingerprint/test-crud",pathname:"/api/fingerprint/test-crud",bundlePath:"",filename:""},userland:a})},3382:(e,t,s)=>{s.d(t,{Q:()=>n,c:()=>i});var a=s(9344),r=s.n(a);function n(e,t){return async(s,a)=>{try{let n=s.headers.authorization;if(!n||!n.startsWith("Bearer "))return a.status(401).json({message:"No token provided"});let i=n.substring(7),c=r().verify(i,"afms-production-jwt-secret-key-2024-ultra-secure-random-string-xyz789");if(!c||!c.id)return a.status(401).json({message:"Token tidak valid"});if(s.user={id:c.id,userId:parseInt(c.id)||1,email:c.email||"",name:c.name||"",role:c.role||"admin"},t&&!(Array.isArray(t)?t:[t]).includes(s.user.role))return a.status(403).json({message:"Insufficient permissions"});return await e(s,a)}catch(e){return a.status(401).json({message:"Token tidak valid"})}}}function i(e){return n(e,"admin")}},7153:(e,t)=>{var s;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return s}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(s||(s={}))},1802:(e,t,s)=>{e.exports=s(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var s=t(t.s=234);module.exports=s})();