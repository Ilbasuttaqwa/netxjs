"use strict";(()=>{var e={};e.id=8079,e.ids=[8079],e.modules={9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},7238:(e,t,a)=>{a.r(t),a.d(t,{config:()=>b,default:()=>f,routeModule:()=>h});var n={};a.r(n),a.d(n,{default:()=>y});var i=a(1802),s=a(7153),r=a(6249),u=a(7777);let o=[{id:1,name:"Keterlambatan 1-15 menit",type:"late",threshold_minutes:15,deduction_type:"fixed",deduction_amount:25e3,is_active:!0},{id:2,name:"Keterlambatan 16-30 menit",type:"late",threshold_minutes:30,deduction_type:"fixed",deduction_amount:5e4,is_active:!0},{id:3,name:"Keterlambatan lebih dari 30 menit",type:"late",threshold_minutes:999,deduction_type:"per_minute",deduction_amount:2e3,max_deduction:2e5,is_active:!0},{id:4,name:"Tidak masuk kerja (Alpha)",type:"absent",deduction_type:"percentage",deduction_amount:3.33,is_active:!0},{id:5,name:"Pulang lebih awal",type:"early_leave",threshold_minutes:30,deduction_type:"per_minute",deduction_amount:1500,max_deduction:1e5,is_active:!0}],d=[{id:1,name:"John Doe",jabatan:"Manager",basic_salary:8e6},{id:2,name:"Jane Smith",jabatan:"Staff",basic_salary:5e6},{id:3,name:"Bob Johnson",jabatan:"Supervisor",basic_salary:65e5}],l=async(e,t)=>{if("GET"===e.method){let{period:a,karyawan_id:n}=e.query;if(!a)return t.status(400).json({success:!1,message:"Parameter period (YYYY-MM) diperlukan"});try{if(n){let e=await c(parseInt(n),a);return t.status(200).json({success:!0,message:"Data pemotongan karyawan berhasil diambil",data:e})}{let e=await _(a);return t.status(200).json({success:!0,message:"Data pemotongan semua karyawan berhasil diambil",data:e})}}catch(e){return t.status(500).json({success:!1,message:e.message||"Gagal menghitung pemotongan gaji"})}}if("POST"===e.method){let{period:a}=e.body;if(!a)return t.status(400).json({success:!1,message:"Parameter period diperlukan"});try{let e=await p(a);return t.status(200).json({success:!0,message:`Pemotongan gaji untuk periode ${a} berhasil diproses`,data:e})}catch(e){return t.status(500).json({success:!1,message:e.message||"Gagal memproses pemotongan gaji"})}}if("PUT"===e.method){let{rule_id:a,...n}=e.body;if(!a)return t.status(400).json({success:!1,message:"Rule ID diperlukan"});try{let e=o.findIndex(e=>e.id===a);if(-1===e)return t.status(404).json({success:!1,message:"Aturan tidak ditemukan"});return o[e]={...o[e],...n},t.status(200).json({success:!0,message:"Aturan berhasil diperbarui",data:o[e]})}catch(e){return t.status(500).json({success:!1,message:e.message||"Gagal memperbarui aturan"})}}return t.status(405).json({success:!1,message:"Method tidak diizinkan"})};async function c(e,t){let a=d.find(t=>t.id===e);if(!a)throw Error("Karyawan tidak ditemukan");let n={total_days:22,present_days:20,late_count:5,absent_count:2,early_leave_count:1,total_late_minutes:75,total_early_leave_minutes:45},i=[],s=0;if(n.late_count>0){let r=function(e,t,a){let n=0,i=o[0],s=t/e;if(s<=15){let t=o.find(e=>"late"===e.type&&15===e.threshold_minutes);t&&(n=t.deduction_amount*e,i=t)}else if(s<=30){let t=o.find(e=>"late"===e.type&&30===e.threshold_minutes);t&&(n=t.deduction_amount*e,i=t)}else{let e=o.find(e=>"late"===e.type&&999===e.threshold_minutes);e&&(n=t*e.deduction_amount,e.max_deduction&&n>e.max_deduction&&(n=e.max_deduction),i=e)}return{amount:n,rule_id:i.id,rule_name:i.name}}(n.late_count,n.total_late_minutes,a.basic_salary);r.amount>0&&(i.push({id:Date.now()+1,karyawan_id:e,period:t,rule_id:r.rule_id,rule_name:r.rule_name,violation_count:n.late_count,total_minutes:n.total_late_minutes,deduction_amount:r.amount,description:`Keterlambatan ${n.late_count} kali, total ${n.total_late_minutes} menit`,created_at:new Date().toISOString()}),s+=r.amount)}if(n.absent_count>0){let r=o.find(e=>"absent"===e.type&&e.is_active);if(r){let u=a.basic_salary*r.deduction_amount/100*n.absent_count;i.push({id:Date.now()+2,karyawan_id:e,period:t,rule_id:r.id,rule_name:r.name,violation_count:n.absent_count,deduction_amount:u,description:`Tidak masuk kerja ${n.absent_count} hari`,created_at:new Date().toISOString()}),s+=u}}if(n.early_leave_count>0){let a=o.find(e=>"early_leave"===e.type&&e.is_active);if(a){let r=n.total_early_leave_minutes*a.deduction_amount;a.max_deduction&&r>a.max_deduction&&(r=a.max_deduction),i.push({id:Date.now()+3,karyawan_id:e,period:t,rule_id:a.id,rule_name:a.name,violation_count:n.early_leave_count,total_minutes:n.total_early_leave_minutes,deduction_amount:r,description:`Pulang cepat ${n.early_leave_count} kali, total ${n.total_early_leave_minutes} menit`,created_at:new Date().toISOString()}),s+=r}}let r=await m(e,t);return r>0&&(i.push({id:Date.now()+4,karyawan_id:e,period:t,rule_id:999,rule_name:"Cicilan Bon Karyawan",violation_count:1,deduction_amount:r,description:`Cicilan bon bulan ${t}`,created_at:new Date().toISOString()}),s+=r),{karyawan_id:e,name:a.name,jabatan:a.jabatan,basic_salary:a.basic_salary,attendance_summary:n,deductions:i,bon_deduction:r,total_deduction:s,net_salary:a.basic_salary-s}}async function _(e){let t=[];for(let a of d){let n=await c(a.id,e);t.push(n)}return t}async function m(e,t){try{let t=[{karyawan_id:1,cicilan_per_bulan:5e5,status:"approved"},{karyawan_id:2,cicilan_per_bulan:3e5,status:"approved"}].find(t=>t.karyawan_id===e&&"approved"===t.status);return t?t.cicilan_per_bulan:0}catch(e){return 0}}async function p(e){let t=await _(e);for(let e of t)e.bon_deduction;return{summary:{period:e,total_employees:t.length,total_deductions:t.reduce((e,t)=>e+t.total_deduction,0),employees_with_deductions:t.filter(e=>e.total_deduction>0).length,processed_at:new Date().toISOString()},details:t}}let y=(0,u.M)(["admin","manager"])(l),f=(0,r.l)(n,"default"),b=(0,r.l)(n,"config"),h=new i.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/payroll/deductions",pathname:"/api/payroll/deductions",bundlePath:"",filename:""},userland:n})},7777:(e,t,a)=>{a.d(t,{M:()=>s});var n=a(9344),i=a.n(n);function s(e){return function(t){var a;return a=async(a,n)=>a.user&&e.includes(a.user.role)?t(a,n):n.status(403).json({error:"Akses ditolak"}),async(e,t)=>{try{let n=e.headers.authorization?.replace("Bearer ","")||e.cookies.token;if(!n)return t.status(401).json({error:"Token tidak ditemukan"});let s=i().verify(n,"afms-jwt-secret-key-2024");return e.user=s,a(e,t)}catch(e){return t.status(401).json({error:"Token tidak valid"})}}}}},7153:(e,t)=>{var a;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},1802:(e,t,a)=>{e.exports=a(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var a=t(t.s=7238);module.exports=a})();