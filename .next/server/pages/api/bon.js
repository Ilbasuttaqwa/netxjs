"use strict";(()=>{var a={};a.id=2478,a.ids=[2478],a.modules={9344:a=>{a.exports=require("jsonwebtoken")},145:a=>{a.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(a,e)=>{Object.defineProperty(e,"l",{enumerable:!0,get:function(){return function a(e,n){return n in e?e[n]:"then"in e&&"function"==typeof e.then?e.then(e=>a(e,n)):"function"==typeof e&&"default"===n?e:void 0}}})},6681:(a,e,n)=>{n.r(e),n.d(e,{config:()=>g,default:()=>p,routeModule:()=>_});var t={};n.r(t),n.d(t,{default:()=>c});var i=n(1802),r=n(7153),s=n(6249),l=n(3382),u=n(3432);let o=[{id:1,karyawan_id:1,jumlah_bon:5e6,sisa_bon:3e6,cicilan_per_bulan:5e5,tanggal_pengajuan:"2024-01-15",tanggal_persetujuan:"2024-01-16",status:"approved",keterangan:"Bon untuk keperluan mendesak",approved_by:1,created_at:"2024-01-15T00:00:00.000Z",updated_at:"2024-01-16T00:00:00.000Z",karyawan:{id:1,nama:"John Doe",telepon:"081234567890",alamat:"Jl. Contoh No. 123",tanggal_lahir:"1990-01-01",jenis_kelamin:"L",cabang_id:1,jabatan_id:1,tanggal_masuk:"2023-01-15",status:"aktif",fingerprint_id:"FP001",created_at:"2023-01-15T00:00:00.000Z",updated_at:"2023-01-15T00:00:00.000Z"}},{id:2,karyawan_id:2,jumlah_bon:3e6,sisa_bon:3e6,cicilan_per_bulan:3e5,tanggal_pengajuan:"2024-01-20",status:"pending",keterangan:"Bon untuk biaya pendidikan anak",created_at:"2024-01-20T00:00:00.000Z",updated_at:"2024-01-20T00:00:00.000Z",karyawan:{id:2,nama:"Jane Smith",telepon:"081234567891",alamat:"Jl. Contoh No. 124",tanggal_lahir:"1992-05-15",jenis_kelamin:"P",cabang_id:1,jabatan_id:2,tanggal_masuk:"2023-02-01",status:"aktif",fingerprint_id:"FP002",created_at:"2023-02-01T00:00:00.000Z",updated_at:"2023-02-01T00:00:00.000Z"}}],m=3;async function d(a,e){try{switch(a.method){case"GET":let{page:n=1,limit:t=10,search:i="",status:r,karyawan_id:s}=a.query,l=[...o];i&&(l=l.filter(a=>a.karyawan?.nama.toLowerCase().includes(i.toString().toLowerCase()))),r&&"all"!==r&&(l=l.filter(a=>a.status===r)),s&&(l=l.filter(a=>a.karyawan_id===parseInt(s.toString())));let d=parseInt(n.toString()),c=parseInt(t.toString()),p=(d-1)*c,g=p+c,_=l.slice(p,g);return e.status(200).json({success:!0,message:"Data bon berhasil diambil",data:_,pagination:{current_page:d,per_page:c,total:l.length,last_page:Math.ceil(l.length/c),from:p+1,to:Math.min(g,l.length)}});case"POST":let k=a.body;if(!k.karyawan_id||!k.jumlah_bon||!k.cicilan_per_bulan)return e.status(400).json({success:!1,message:"Data tidak lengkap",errors:{karyawan_id:k.karyawan_id?[]:["Karyawan harus dipilih"],jumlah_bon:k.jumlah_bon?[]:["Jumlah bon harus diisi"],cicilan_per_bulan:k.cicilan_per_bulan?[]:["Cicilan per bulan harus diisi"]}});if(k.jumlah_bon<=0||k.cicilan_per_bulan<=0)return e.status(400).json({success:!1,message:"Jumlah bon dan cicilan harus lebih dari 0"});let h={id:k.karyawan_id,gaji_pokok:5e6,tanggal_masuk:"2023-01-15",status:"active"},b=Math.ceil(k.jumlah_bon/k.cicilan_per_bulan),j=o.map(a=>({id:a.id,karyawan_id:a.karyawan_id,jumlah_bon:a.jumlah_bon,sisa_bon:a.sisa_bon,cicilan_per_bulan:a.cicilan_per_bulan,status:a.status,tanggal_pengajuan:a.tanggal_pengajuan,tanggal_persetujuan:a.tanggal_persetujuan})),P=(0,u.l9)(h,k.jumlah_bon,b,j,u.xW);if(!P.isValid)return e.status(400).json({success:!1,message:"Pengajuan bon tidak valid",errors:P.errors,warnings:P.warnings});let f={id:m++,karyawan_id:k.karyawan_id,jumlah_bon:k.jumlah_bon,sisa_bon:k.jumlah_bon,cicilan_per_bulan:k.cicilan_per_bulan,tanggal_pengajuan:new Date().toISOString().split("T")[0],status:"pending",keterangan:k.keterangan,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return o.push(f),e.status(201).json({success:!0,message:"Bon berhasil diajukan",data:f});default:return e.setHeader("Allow",["GET","POST"]),e.status(405).json({success:!1,message:`Method ${a.method} tidak diizinkan`})}}catch(a){return e.status(500).json({success:!1,message:"Terjadi kesalahan server"})}}let c=(0,l.c)(d),p=(0,s.l)(t,"default"),g=(0,s.l)(t,"config"),_=new i.PagesAPIRouteModule({definition:{kind:r.x.PAGES_API,page:"/api/bon",pathname:"/api/bon",bundlePath:"",filename:""},userland:t})},3382:(a,e,n)=>{n.d(e,{Q:()=>r,c:()=>s});var t=n(9344),i=n.n(t);function r(a,e){return async(n,t)=>{try{let r=n.headers.authorization;if(!r||!r.startsWith("Bearer "))return t.status(401).json({message:"No token provided"});let s=r.substring(7),l=i().verify(s,"afms-jwt-secret-key-2024");if(!l||!l.id)return t.status(401).json({message:"Token tidak valid"});if(n.user={id:l.id,userId:parseInt(l.id)||1,email:l.email||"",name:l.name||"",role:l.role||"admin"},e&&!(Array.isArray(e)?e:[e]).includes(n.user.role))return t.status(403).json({message:"Insufficient permissions"});return await a(n,t)}catch(a){return t.status(401).json({message:"Token tidak valid"})}}}function s(a){return r(a,"admin")}},3432:(a,e,n)=>{n.d(e,{Ks:()=>l,PR:()=>r,l9:()=>i,lR:()=>s,xW:()=>t});let t={maxBonPercentage:80,maxBonAmount:1e7,minInstallmentPeriod:3,maxInstallmentPeriod:24,maxActiveBonPerEmployee:1,minEmploymentDuration:6,maxInstallmentPercentage:30,minTimeBetweenApplications:1};function i(a,e,n,i,r=t){let s=[],l=[];"active"!==a.status&&s.push("Karyawan harus dalam status aktif untuk mengajukan bon");let u=new Date(a.tanggal_masuk),o=new Date,m=Math.floor((o.getTime()-u.getTime())/2592e6);m<r.minEmploymentDuration&&s.push(`Karyawan harus bekerja minimal ${r.minEmploymentDuration} bulan untuk mengajukan bon. Saat ini baru ${m} bulan.`);let d=a.gaji_pokok*r.maxBonPercentage/100;e>d&&s.push(`Jumlah bon tidak boleh melebihi ${r.maxBonPercentage}% dari gaji pokok. Maksimal: Rp ${d.toLocaleString("id-ID")}`),e>r.maxBonAmount&&s.push(`Jumlah bon tidak boleh melebihi Rp ${r.maxBonAmount.toLocaleString("id-ID")}`),n<r.minInstallmentPeriod&&s.push(`Periode cicilan minimal ${r.minInstallmentPeriod} bulan`),n>r.maxInstallmentPeriod&&s.push(`Periode cicilan maksimal ${r.maxInstallmentPeriod} bulan`);let c=e/n,p=a.gaji_pokok*r.maxInstallmentPercentage/100;c>p&&s.push(`Cicilan bulanan tidak boleh melebihi ${r.maxInstallmentPercentage}% dari gaji pokok. Maksimal: Rp ${p.toLocaleString("id-ID")}, Cicilan yang diajukan: Rp ${c.toLocaleString("id-ID")}`);let g=i.filter(e=>e.karyawan_id===a.id&&["pending","approved"].includes(e.status)&&e.sisa_bon>0);g.length>=r.maxActiveBonPerEmployee&&s.push(`Karyawan sudah memiliki ${g.length} bon aktif. Maksimal ${r.maxActiveBonPerEmployee} bon aktif per karyawan.`),i.filter(e=>{let n=new Date(e.tanggal_pengajuan),t=Math.floor((o.getTime()-n.getTime())/2592e6);return e.karyawan_id===a.id&&t<r.minTimeBetweenApplications}).length>0&&s.push(`Harus menunggu minimal ${r.minTimeBetweenApplications} bulan sejak pengajuan bon terakhir`);let _=g.reduce((a,e)=>a+e.cicilan_per_bulan,0)+c,k=a.gaji_pokok*r.maxInstallmentPercentage/100;return _>k&&s.push(`Total cicilan (termasuk bon aktif) tidak boleh melebihi ${r.maxInstallmentPercentage}% dari gaji. Total cicilan: Rp ${_.toLocaleString("id-ID")}, Maksimal: Rp ${k.toLocaleString("id-ID")}`),e>.7*d&&l.push(`Jumlah bon cukup besar (${Math.round(e/d*100)}% dari maksimal). Pastikan karyawan mampu membayar cicilan.`),n>12&&l.push(`Periode cicilan cukup panjang (${n} bulan). Pertimbangkan risiko perubahan status karyawan.`),{isValid:0===s.length,errors:s,warnings:l}}function r(a,e,n=t){let i=e*n.maxInstallmentPercentage/100;return Math.max(n.minInstallmentPeriod,Math.min(Math.ceil(a/i),n.maxInstallmentPeriod))}function s(a,e,n=t){let i=a.gaji_pokok*n.maxBonPercentage/100,r=n.maxBonAmount,s=e.filter(e=>e.karyawan_id===a.id&&["pending","approved"].includes(e.status)&&e.sisa_bon>0).reduce((a,e)=>a+e.cicilan_per_bulan,0);return Math.min(i,r,Math.max(0,(a.gaji_pokok*n.maxInstallmentPercentage/100-s)*n.minInstallmentPeriod))}function l(a,e,n=t){let i=[],l=!0;"active"!==a.status&&(l=!1,i.push("Status karyawan tidak aktif"));let u=new Date(a.tanggal_masuk);Math.floor((new Date().getTime()-u.getTime())/2592e6)<n.minEmploymentDuration&&(l=!1,i.push(`Masa kerja kurang dari ${n.minEmploymentDuration} bulan`)),e.filter(e=>e.karyawan_id===a.id&&["pending","approved"].includes(e.status)&&e.sisa_bon>0).length>=n.maxActiveBonPerEmployee&&(l=!1,i.push("Sudah memiliki bon aktif maksimal"));let o=s(a,e,n);o<=0&&(l=!1,i.push("Kapasitas cicilan sudah penuh"));let m=r(o,a.gaji_pokok,n);return{isEligible:l,reasons:i,maxAmount:o,recommendedPeriod:m}}},7153:(a,e)=>{var n;Object.defineProperty(e,"x",{enumerable:!0,get:function(){return n}}),function(a){a.PAGES="PAGES",a.PAGES_API="PAGES_API",a.APP_PAGE="APP_PAGE",a.APP_ROUTE="APP_ROUTE"}(n||(n={}))},1802:(a,e,n)=>{a.exports=n(145)}};var e=require("../../webpack-api-runtime.js");e.C(a);var n=e(e.s=6681);module.exports=n})();