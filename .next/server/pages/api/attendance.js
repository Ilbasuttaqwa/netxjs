"use strict";(()=>{var e={};e.id=7015,e.ids=[7015],e.modules={3524:e=>{e.exports=require("@prisma/client")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,a)=>{Object.defineProperty(a,"l",{enumerable:!0,get:function(){return function e(a,t){return t in a?a[t]:"then"in a&&"function"==typeof a.then?a.then(a=>e(a,t)):"function"==typeof a&&"default"===t?a:void 0}}})},5078:(e,a,t)=>{t.r(a),t.d(a,{config:()=>l,default:()=>o,routeModule:()=>c});var n={};t.r(n),t.d(n,{default:()=>d});var i=t(1802),s=t(7153),r=t(6249);let u=new(t(3524)).PrismaClient;async function d(e,a){if("GET"!==e.method)return a.status(405).json({message:"Method not allowed"});try{let{page:t="1",pageSize:n="10",search:i="",sortField:s="tanggal",sortOrder:r="desc",dateFrom:d,dateTo:o,status:l}=e.query,c=parseInt(t),g=parseInt(n),m={};i&&(m.user={OR:[{nama_pegawai:{contains:i,mode:"insensitive"}},{email:{contains:i,mode:"insensitive"}}]}),(d||o)&&(m.tanggal={},d&&(m.tanggal.gte=new Date(d)),o&&(m.tanggal.lte=new Date(o))),l&&(m.status=l);let p={};"user.name"===s?p.user={nama_pegawai:r}:p[s]=r;let P=await u.absensi.count({where:m}),_=await u.absensi.findMany({where:m,include:{user:{select:{id:!0,nama_pegawai:!0}}},orderBy:p,skip:(c-1)*g,take:g}),f=Math.ceil(P/g),w=_.map(e=>({id:e.id.toString(),user_id:e.id_user.toString(),tanggal:e.tanggal,jam_masuk:e.jam_masuk,jam_keluar:e.jam_keluar,status:e.status,keterangan:e.keterangan,created_at:e.created_at,updated_at:e.updated_at,user:{id:e.user.id.toString(),name:e.user.nama_pegawai,username:e.user.nama_pegawai}}));a.status(200).json({data:w,pagination:{current:c,pageSize:g,total:P,totalPages:f},success:!0})}catch(e){a.status(500).json({message:"Terjadi kesalahan server",success:!1})}}let o=(0,r.l)(n,"default"),l=(0,r.l)(n,"config"),c=new i.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/attendance",pathname:"/api/attendance",bundlePath:"",filename:""},userland:n})},7153:(e,a)=>{var t;Object.defineProperty(a,"x",{enumerable:!0,get:function(){return t}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(e,a,t)=>{e.exports=t(145)}};var a=require("../../webpack-api-runtime.js");a.C(e);var t=a(a.s=5078);module.exports=t})();