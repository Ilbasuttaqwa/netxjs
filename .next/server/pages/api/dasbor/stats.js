"use strict";(()=>{var a={};a.id=8284,a.ids=[8284],a.modules={3524:a=>{a.exports=require("@prisma/client")},9344:a=>{a.exports=require("jsonwebtoken")},145:a=>{a.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(a,e)=>{Object.defineProperty(e,"l",{enumerable:!0,get:function(){return function a(e,t){return t in e?e[t]:"then"in e&&"function"==typeof e.then?e.then(e=>a(e,t)):"function"==typeof e&&"default"===t?e:void 0}}})},7589:(a,e,t)=>{t.r(e),t.d(e,{config:()=>c,default:()=>m,routeModule:()=>h});var r={};t.r(r),t.d(r,{default:()=>_});var n=t(1802),s=t(7153),i=t(6249),u=t(3382),o=t(1450);let l={admin:{total_karyawan:150,total_cabang:5,total_hadir_hari_ini:142,total_terlambat_hari_ini:8,total_alpha_hari_ini:0,persentase_kehadiran:94.7},user:{total_hadir_hari_ini:1,total_terlambat_hari_ini:0,jam_masuk:"08:00",jam_keluar:"17:00",status_hari_ini:"Hadir"}};async function d(a,e){if("GET"!==a.method)return e.status(405).json({message:"Method not allowed"});try{let t=a.user?.role,r=new Date;r.setHours(0,0,0,0);let n=new Date(r);if(n.setDate(n.getDate()+1),"admin"===t||"manager"===t)try{let[a,t,s]=await Promise.all([o._.user.count({where:{role:{not:"admin"}}}),o._.cabang.count(),o._.absensi.findMany({where:{tanggal:{gte:r,lt:n}},include:{user:{include:{jabatan:!0}}}})]),i=s.filter(a=>a.jam_masuk).length,u=s.filter(a=>{if(!a.jam_masuk||!a.user?.jabatan)return!1;let e=new Date(a.jam_masuk),t=new Date(a.user.jabatan.jam_masuk||"08:00");return e>t}).length;return e.status(200).json({success:!0,data:{total_karyawan:a,total_cabang:t,total_hadir_hari_ini:i,total_terlambat_hari_ini:u,total_alpha_hari_ini:a-i,persentase_kehadiran:a>0?Math.round(i/a*100):0}})}catch(a){return e.status(200).json({success:!0,data:l.admin})}else try{let t=a.user?.id;if(!t)return e.status(401).json({message:"User ID not found"});let s=await o._.absensi.findFirst({where:{id_user:parseInt(t),tanggal:{gte:r,lt:n}},include:{user:{include:{jabatan:!0}}}}),i=s?.jam_masuk?"Hadir":"Belum Absen",u=s?.user?.jabatan?.jam_masuk||"08:00";return e.status(200).json({success:!0,data:{total_hadir_hari_ini:s?.jam_masuk?1:0,total_terlambat_hari_ini:0,jam_masuk:u,jam_keluar:"17:00",status_hari_ini:i}})}catch(a){return e.status(200).json({success:!0,data:l.user})}}catch(a){return e.status(500).json({message:"Terjadi kesalahan server"})}}let _=(0,u.Q)(d),m=(0,i.l)(r,"default"),c=(0,i.l)(r,"config"),h=new n.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/dasbor/stats",pathname:"/api/dasbor/stats",bundlePath:"",filename:""},userland:r})},3382:(a,e,t)=>{t.d(e,{Q:()=>s,c:()=>i});var r=t(9344),n=t.n(r);function s(a,e){return async(t,r)=>{try{let s=t.headers.authorization;if(!s||!s.startsWith("Bearer "))return r.status(401).json({message:"No token provided"});let i=s.substring(7),u=n().verify(i,"GANTI-DENGAN-RANDOM-STRING-32-KARAKTER-ATAU-LEBIH");if(!u||!u.id)return r.status(401).json({message:"Token tidak valid"});if(t.user={id:u.id,userId:parseInt(u.id)||1,email:u.email||"",name:u.name||"",role:u.role||"admin"},e&&!(Array.isArray(e)?e:[e]).includes(t.user.role))return r.status(403).json({message:"Insufficient permissions"});return await a(t,r)}catch(a){return r.status(401).json({message:"Token tidak valid"})}}}function i(a){return s(a,"admin")}},1450:(a,e,t)=>{t.d(e,{_:()=>n});var r=t(3524);let n=globalThis.prisma??new r.PrismaClient({log:["query"]})},7153:(a,e)=>{var t;Object.defineProperty(e,"x",{enumerable:!0,get:function(){return t}}),function(a){a.PAGES="PAGES",a.PAGES_API="PAGES_API",a.APP_PAGE="APP_PAGE",a.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(a,e,t)=>{a.exports=t(145)}};var e=require("../../../webpack-api-runtime.js");e.C(a);var t=e(e.s=7589);module.exports=t})();