"use strict";(()=>{var a={};a.id=9044,a.ids=[9044],a.modules={9344:a=>{a.exports=require("jsonwebtoken")},145:a=>{a.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(a,e)=>{Object.defineProperty(e,"l",{enumerable:!0,get:function(){return function a(e,t){return t in e?e[t]:"then"in e&&"function"==typeof e.then?e.then(e=>a(e,t)):"function"==typeof e&&"default"===t?e:void 0}}})},9407:(a,e,t)=>{t.r(e),t.d(e,{config:()=>_,default:()=>m,routeModule:()=>c});var r={};t.r(r),t.d(r,{default:()=>u});var n=t(1802),i=t(7153),s=t(6249),o=t(3382);let l={monthly_report:[{karyawan_id:1,karyawan:{nama:"John Doe",email:"john@afms.com",jabatan:"Manager"},total_hari_kerja:22,total_hadir:20,total_terlambat:2,total_tidak_hadir:0,total_jam_kerja:176,percentage_kehadiran:90.9},{karyawan_id:2,karyawan:{nama:"Jane Smith",email:"jane@afms.com",jabatan:"Staff"},total_hari_kerja:22,total_hadir:18,total_terlambat:3,total_tidak_hadir:1,total_jam_kerja:162,percentage_kehadiran:81.8}],daily_report:[{tanggal:"2024-01-15",total_karyawan:25,hadir:20,terlambat:3,tidak_hadir:2,percentage_hadir:80},{tanggal:"2024-01-16",total_karyawan:25,hadir:22,terlambat:2,tidak_hadir:1,percentage_hadir:88}],cabang_report:[{cabang_id:1,nama_cabang:"Kantor Utama",alamat:"Jl. Sudirman No. 123",total_karyawan:15,avg_kehadiran:85.5,total_terlambat:12,total_tidak_hadir:8},{cabang_id:2,nama_cabang:"Cabang Jakarta",alamat:"Jl. Thamrin No. 456",total_karyawan:10,avg_kehadiran:82.3,total_terlambat:8,total_tidak_hadir:5}]};async function d(a,e){try{if("GET"===a.method){let t;let{type:r="monthly",bulan:n,tahun:i,tanggal_mulai:s,tanggal_selesai:o,karyawan_id:d,cabang_id:u,format:m="json"}=a.query;if(a.user?.role!=="admin"&&d&&d!==a.user?.userId?.toString())return e.status(403).json({message:"Insufficient permissions"});switch(r){case"monthly":t=l.monthly_report,d&&(t=t.filter(a=>a.karyawan_id===parseInt(d.toString()))),a.user?.role!=="admin"&&(t=t.filter(e=>e.karyawan_id===a.user?.userId));break;case"daily":if(a.user?.role!=="admin")return e.status(403).json({message:"Daily reports are only available for admin users"});t=l.daily_report,s&&(t=t.filter(a=>a.tanggal>=s)),o&&(t=t.filter(a=>a.tanggal<=o));break;case"cabang":if(a.user?.role!=="admin")return e.status(403).json({message:"Branch reports are only available for admin users"});t=l.cabang_report,u&&(t=t.filter(a=>a.cabang_id===parseInt(u.toString())));break;case"summary":let _={period:n&&i?`${n}/${i}`:"Current Month",total_karyawan:a.user?.role==="admin"?25:1,avg_kehadiran:84.2,total_hari_kerja:22,best_performer:{nama:"John Doe",percentage_kehadiran:95.5},worst_performer:a.user?.role==="admin"?{nama:"Jane Smith",percentage_kehadiran:75}:null};return e.status(200).json({success:!0,data:_});default:return e.status(400).json({message:"Invalid report type. Use: monthly, daily, cabang, or summary"})}if("csv"===m)return e.setHeader("Content-Type","text/csv"),e.setHeader("Content-Disposition",`attachment; filename="laporan_${r}_${new Date().toISOString().split("T")[0]}.csv"`),e.status(200).send("Name,Email,Attendance\nJohn Doe,john@afms.com,90.9%\nJane Smith,jane@afms.com,81.8%");return e.status(200).json({success:!0,data:t,meta:{type:r,generated_at:new Date().toISOString(),period:n&&i?`${n}/${i}`:"Current Period"}})}return e.status(405).json({message:"Method not allowed"})}catch(a){return e.status(500).json({message:"Internal server error"})}}let u=(0,o.Q)(d),m=(0,s.l)(r,"default"),_=(0,s.l)(r,"config"),c=new n.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/laporan",pathname:"/api/laporan",bundlePath:"",filename:""},userland:r})},3382:(a,e,t)=>{t.d(e,{Q:()=>i,c:()=>s});var r=t(9344),n=t.n(r);function i(a,e){return async(t,r)=>{try{let i=t.headers.authorization;if(!i||!i.startsWith("Bearer "))return r.status(401).json({message:"No token provided"});let s=i.substring(7),o=n().verify(s,"afms-production-jwt-secret-key-2024-ultra-secure-random-string-xyz789");if(!o||!o.id)return r.status(401).json({message:"Token tidak valid"});if(t.user={id:o.id,userId:parseInt(o.id)||1,email:o.email||"",name:o.name||"",role:o.role||"admin"},e&&!(Array.isArray(e)?e:[e]).includes(t.user.role))return r.status(403).json({message:"Insufficient permissions"});return await a(t,r)}catch(a){return r.status(401).json({message:"Token tidak valid"})}}}function s(a){return i(a,"admin")}},7153:(a,e)=>{var t;Object.defineProperty(e,"x",{enumerable:!0,get:function(){return t}}),function(a){a.PAGES="PAGES",a.PAGES_API="PAGES_API",a.APP_PAGE="APP_PAGE",a.APP_ROUTE="APP_ROUTE"}(t||(t={}))},1802:(a,e,t)=>{a.exports=t(145)}};var e=require("../../webpack-api-runtime.js");e.C(a);var t=e(e.s=9407);module.exports=t})();