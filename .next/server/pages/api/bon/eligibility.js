"use strict";(()=>{var a={};a.id=6169,a.ids=[6169],a.modules={9344:a=>{a.exports=require("jsonwebtoken")},145:a=>{a.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(a,e)=>{Object.defineProperty(e,"l",{enumerable:!0,get:function(){return function a(e,n){return n in e?e[n]:"then"in e&&"function"==typeof e.then?e.then(e=>a(e,n)):"function"==typeof e&&"default"===n?e:void 0}}})},7163:(a,e,n)=>{n.r(e),n.d(e,{config:()=>g,default:()=>c,routeModule:()=>k});var t={};n.r(t),n.d(t,{default:()=>p});var i=n(1802),l=n(7153),s=n(6249),r=n(3382),o=n(3432);let m=[{id:1,gaji_pokok:5e6,tanggal_masuk:"2023-01-15",status:"active"},{id:2,gaji_pokok:7e6,tanggal_masuk:"2022-06-10",status:"active"},{id:3,gaji_pokok:4e6,tanggal_masuk:"2024-01-01",status:"active"}],u=[{id:1,karyawan_id:1,jumlah_bon:5e6,sisa_bon:3e6,cicilan_per_bulan:5e5,tanggal_pengajuan:"2024-01-15",tanggal_persetujuan:"2024-01-16",status:"approved",keterangan:"Bon untuk keperluan mendesak",approved_by:1,created_at:"2024-01-15T00:00:00.000Z",updated_at:"2024-01-16T00:00:00.000Z"}];async function d(a,e){try{if("GET"!==a.method)return e.setHeader("Allow",["GET"]),e.status(405).json({success:!1,message:`Method ${a.method} tidak diizinkan`});let{karyawan_id:n,amount:t}=a.query;if(!n)return e.status(400).json({success:!1,message:"Karyawan ID harus diisi"});let i=m.find(a=>a.id===parseInt(n.toString()));if(!i)return e.status(404).json({success:!1,message:"Data karyawan tidak ditemukan"});let l=u.map(a=>({id:a.id,karyawan_id:a.karyawan_id,jumlah_bon:a.jumlah_bon,sisa_bon:a.sisa_bon,cicilan_per_bulan:a.cicilan_per_bulan,status:a.status,tanggal_pengajuan:a.tanggal_pengajuan,tanggal_persetujuan:a.tanggal_persetujuan})),s=(0,o.Ks)(i,l,o.xW),r=(0,o.lR)(i,l,o.xW),d=0,p=0;if(t){let a=parseInt(t.toString());d=(0,o.PR)(a,i.gaji_pokok,o.xW),p=Math.ceil(a/d)}let c=l.filter(a=>a.karyawan_id===i.id&&["pending","approved"].includes(a.status)&&a.sisa_bon>0),g=c.reduce((a,e)=>a+e.cicilan_per_bulan,0),k=i.gaji_pokok*o.xW.maxInstallmentPercentage/100;return e.status(200).json({success:!0,message:"Data kelayakan bon berhasil diambil",data:{employee:{id:i.id,gaji_pokok:i.gaji_pokok,tanggal_masuk:i.tanggal_masuk,status:i.status},eligibility:{isEligible:s.isEligible,reasons:s.reasons,maxAmount:r,recommendedPeriod:s.recommendedPeriod},capacity:{maxInstallmentCapacity:k,currentInstallmentBurden:g,availableInstallmentCapacity:k-g,activeBonsCount:c.length,maxActiveBons:o.xW.maxActiveBonPerEmployee},calculation:t?{requestedAmount:parseInt(t.toString()),recommendedPeriod:d,monthlyInstallment:p,totalInstallmentBurden:g+p,installmentPercentage:Math.round((g+p)/i.gaji_pokok*100)}:null,rules:{maxBonPercentage:o.xW.maxBonPercentage,maxBonAmount:o.xW.maxBonAmount,minInstallmentPeriod:o.xW.minInstallmentPeriod,maxInstallmentPeriod:o.xW.maxInstallmentPeriod,maxActiveBonPerEmployee:o.xW.maxActiveBonPerEmployee,minEmploymentDuration:o.xW.minEmploymentDuration,maxInstallmentPercentage:o.xW.maxInstallmentPercentage,minTimeBetweenApplications:o.xW.minTimeBetweenApplications}}})}catch(a){return e.status(500).json({success:!1,message:"Terjadi kesalahan server"})}}let p=(0,r.c)(d),c=(0,s.l)(t,"default"),g=(0,s.l)(t,"config"),k=new i.PagesAPIRouteModule({definition:{kind:l.x.PAGES_API,page:"/api/bon/eligibility",pathname:"/api/bon/eligibility",bundlePath:"",filename:""},userland:t})},3382:(a,e,n)=>{n.d(e,{Q:()=>l,c:()=>s});var t=n(9344),i=n.n(t);function l(a,e){return async(n,t)=>{try{let l=n.headers.authorization;if(!l||!l.startsWith("Bearer "))return t.status(401).json({message:"No token provided"});let s=l.substring(7),r=i().verify(s,"your-super-secret-jwt-key-here-development");if(!r||!r.id)return t.status(401).json({message:"Invalid token"});if(n.user={id:r.id,userId:parseInt(r.id)||1,email:r.email||"",name:r.name||"",role:r.role||"admin"},e&&!(Array.isArray(e)?e:[e]).includes(n.user.role))return t.status(403).json({message:"Insufficient permissions"});return await a(n,t)}catch(a){return t.status(401).json({message:"Invalid token"})}}}function s(a){return l(a,"admin")}},3432:(a,e,n)=>{n.d(e,{Ks:()=>r,PR:()=>l,l9:()=>i,lR:()=>s,xW:()=>t});let t={maxBonPercentage:80,maxBonAmount:1e7,minInstallmentPeriod:3,maxInstallmentPeriod:24,maxActiveBonPerEmployee:1,minEmploymentDuration:6,maxInstallmentPercentage:30,minTimeBetweenApplications:1};function i(a,e,n,i,l=t){let s=[],r=[];"active"!==a.status&&s.push("Karyawan harus dalam status aktif untuk mengajukan bon");let o=new Date(a.tanggal_masuk),m=new Date,u=Math.floor((m.getTime()-o.getTime())/2592e6);u<l.minEmploymentDuration&&s.push(`Karyawan harus bekerja minimal ${l.minEmploymentDuration} bulan untuk mengajukan bon. Saat ini baru ${u} bulan.`);let d=a.gaji_pokok*l.maxBonPercentage/100;e>d&&s.push(`Jumlah bon tidak boleh melebihi ${l.maxBonPercentage}% dari gaji pokok. Maksimal: Rp ${d.toLocaleString("id-ID")}`),e>l.maxBonAmount&&s.push(`Jumlah bon tidak boleh melebihi Rp ${l.maxBonAmount.toLocaleString("id-ID")}`),n<l.minInstallmentPeriod&&s.push(`Periode cicilan minimal ${l.minInstallmentPeriod} bulan`),n>l.maxInstallmentPeriod&&s.push(`Periode cicilan maksimal ${l.maxInstallmentPeriod} bulan`);let p=e/n,c=a.gaji_pokok*l.maxInstallmentPercentage/100;p>c&&s.push(`Cicilan bulanan tidak boleh melebihi ${l.maxInstallmentPercentage}% dari gaji pokok. Maksimal: Rp ${c.toLocaleString("id-ID")}, Cicilan yang diajukan: Rp ${p.toLocaleString("id-ID")}`);let g=i.filter(e=>e.karyawan_id===a.id&&["pending","approved"].includes(e.status)&&e.sisa_bon>0);g.length>=l.maxActiveBonPerEmployee&&s.push(`Karyawan sudah memiliki ${g.length} bon aktif. Maksimal ${l.maxActiveBonPerEmployee} bon aktif per karyawan.`),i.filter(e=>{let n=new Date(e.tanggal_pengajuan),t=Math.floor((m.getTime()-n.getTime())/2592e6);return e.karyawan_id===a.id&&t<l.minTimeBetweenApplications}).length>0&&s.push(`Harus menunggu minimal ${l.minTimeBetweenApplications} bulan sejak pengajuan bon terakhir`);let k=g.reduce((a,e)=>a+e.cicilan_per_bulan,0)+p,h=a.gaji_pokok*l.maxInstallmentPercentage/100;return k>h&&s.push(`Total cicilan (termasuk bon aktif) tidak boleh melebihi ${l.maxInstallmentPercentage}% dari gaji. Total cicilan: Rp ${k.toLocaleString("id-ID")}, Maksimal: Rp ${h.toLocaleString("id-ID")}`),e>.7*d&&r.push(`Jumlah bon cukup besar (${Math.round(e/d*100)}% dari maksimal). Pastikan karyawan mampu membayar cicilan.`),n>12&&r.push(`Periode cicilan cukup panjang (${n} bulan). Pertimbangkan risiko perubahan status karyawan.`),{isValid:0===s.length,errors:s,warnings:r}}function l(a,e,n=t){let i=e*n.maxInstallmentPercentage/100;return Math.max(n.minInstallmentPeriod,Math.min(Math.ceil(a/i),n.maxInstallmentPeriod))}function s(a,e,n=t){let i=a.gaji_pokok*n.maxBonPercentage/100,l=n.maxBonAmount,s=e.filter(e=>e.karyawan_id===a.id&&["pending","approved"].includes(e.status)&&e.sisa_bon>0).reduce((a,e)=>a+e.cicilan_per_bulan,0);return Math.min(i,l,Math.max(0,(a.gaji_pokok*n.maxInstallmentPercentage/100-s)*n.minInstallmentPeriod))}function r(a,e,n=t){let i=[],r=!0;"active"!==a.status&&(r=!1,i.push("Status karyawan tidak aktif"));let o=new Date(a.tanggal_masuk);Math.floor((new Date().getTime()-o.getTime())/2592e6)<n.minEmploymentDuration&&(r=!1,i.push(`Masa kerja kurang dari ${n.minEmploymentDuration} bulan`)),e.filter(e=>e.karyawan_id===a.id&&["pending","approved"].includes(e.status)&&e.sisa_bon>0).length>=n.maxActiveBonPerEmployee&&(r=!1,i.push("Sudah memiliki bon aktif maksimal"));let m=s(a,e,n);m<=0&&(r=!1,i.push("Kapasitas cicilan sudah penuh"));let u=l(m,a.gaji_pokok,n);return{isEligible:r,reasons:i,maxAmount:m,recommendedPeriod:u}}},7153:(a,e)=>{var n;Object.defineProperty(e,"x",{enumerable:!0,get:function(){return n}}),function(a){a.PAGES="PAGES",a.PAGES_API="PAGES_API",a.APP_PAGE="APP_PAGE",a.APP_ROUTE="APP_ROUTE"}(n||(n={}))},1802:(a,e,n)=>{a.exports=n(145)}};var e=require("../../../webpack-api-runtime.js");e.C(a);var n=e(e.s=7163);module.exports=n})();